<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>REMEEX Visa Banking</title>
  <link rel="icon" href="https://w7.pngwing.com/pngs/400/28/png-transparent-credit-card-computer-icons-visa-electron-bank-curio-blue-text-rectangle-thumbnail.png" type="image/png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/v-mask@2.3.0/dist/v-mask.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.11.4/dist/gsap.min.js"></script>

  <style>
    :root {
      /* Modern color palette based on Revolut/N26 style */
      --primary: #1a1f71;
      --primary-dark: #0c1045;
      --primary-light: #3244b6;
      --secondary: #00579f;
      --accent: #f7b600;
      --success: #00d34d;
      --danger: #ff4d4d;
      --warning: #ffad33;
      --info: #0095ff;
      --neutral-100: #ffffff;
      --neutral-200: #f5f7fa;
      --neutral-300: #eaecf0;
      --neutral-400: #d0d5dd;
      --neutral-500: #9da4b4;
      --neutral-600: #6e7891;
      --neutral-700: #4f5d75;
      --neutral-800: #293249;
      --neutral-900: #1a1f37;

      /* Shadows & Effects */
      --shadow-sm: 0 1px 3px rgba(16, 24, 40, 0.1);
      --shadow-md: 0 4px 8px -2px rgba(16, 24, 40, 0.1), 0 2px 4px -2px rgba(16, 24, 40, 0.06);
      --shadow-lg: 0 12px 16px -4px rgba(16, 24, 40, 0.08), 0 4px 6px -2px rgba(16, 24, 40, 0.03);
      --shadow-xl: 0 20px 24px -4px rgba(16, 24, 40, 0.08), 0 8px 8px -4px rgba(16, 24, 40, 0.03);
      --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
      
      /* Border radius */
      --radius-sm: 6px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --radius-full: 9999px;
      
      /* Transitions */
      --transition-fast: all 0.2s ease;
      --transition-base: all 0.3s ease;
      --transition-slow: all 0.5s ease;
      
      /* Card gradients */
      --card-gradient: linear-gradient(135deg, #1a1f71 0%, #0c1045 100%);
      --success-gradient: linear-gradient(135deg, #00c057 0%, #00a346 100%);
      
      /* Animations */
      --animation-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--neutral-200);
      color: var(--neutral-900);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
      height: 100vh;
      margin: 0;
      position: relative;
    }
    
    /* Scrollbars */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--neutral-200);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--neutral-500);
      border-radius: var(--radius-full);
    }
    
    /* Header */
    .app-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.6rem 1rem;
      background: var(--neutral-100);
      border-bottom: 1px solid var(--neutral-300);
      box-shadow: var(--shadow-sm);
      z-index: 1000;
      height: 60px;
    }
    
    .header-brand {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .header-brand img {
      height: 32px;
      width: auto;
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .header-action-btn {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--neutral-200);
      color: var(--neutral-700);
      border: none;
      cursor: pointer;
      transition: var(--transition-base);
      position: relative;
    }
    
    .header-action-btn:hover {
      background: var(--neutral-300);
      color: var(--neutral-900);
    }
    
    .notification-badge {
      position: absolute;
      top: -2px;
      right: -2px;
      background: var(--danger);
      color: white;
      border-radius: var(--radius-full);
      font-size: 0.6rem;
      width: 16px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }
    
    /* Connected Users Badge */
    .users-online-badge {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.5rem;
      background: rgba(26, 31, 113, 0.08);
      border-radius: var(--radius-md);
      font-size: 0.7rem;
      color: var(--primary);
      font-weight: 500;
      white-space: nowrap;
    }
    
    .users-online-badge i {
      font-size: 0.7rem;
    }
    
    .pulse-dot {
      width: 6px;
      height: 6px;
      background-color: var(--success);
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(0, 211, 77, 0.7);
      }
      
      70% {
        transform: scale(1);
        box-shadow: 0 0 0 4px rgba(0, 211, 77, 0);
      }
      
      100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(0, 211, 77, 0);
      }
    }
    
    /* Account Balance Card */
    .balance-card {
      background: var(--card-gradient);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      color: white;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
      margin-bottom: 1.25rem;
      transition: transform 0.3s var(--animation-bounce), box-shadow 0.3s ease;
    }
    
    .balance-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-xl);
    }
    
    .balance-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      animation: shine 3s infinite;
    }
    
    @keyframes shine {
      100% { left: 200%; }
    }
    
    .card-decoration {
      position: absolute;
      right: -50px;
      bottom: -50px;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
      z-index: 1;
    }
    
    .card-decoration:nth-child(2) {
      left: -30px;
      top: -30px;
      width: 150px;
      height: 150px;
    }
    
    .balance-content {
      position: relative;
      z-index: 2;
    }
    
    .balance-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .header-avatar {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: rgba(255, 255, 255, 0.2);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.8rem;
      flex-shrink: 0;
    }

    .balance-label {
      font-size: 0.8rem;
      opacity: 0.8;
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .balance-label i {
      font-size: 0.9rem;
    }
    
    .balance-amount {
      font-size: clamp(1.5rem, 5vw, 2.25rem);
      font-weight: 700;
      margin: 0.5rem 0 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: nowrap;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .currency-flag {
      width: 20px;
      height: 14px;
      border-radius: 2px;
      object-fit: cover;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      flex-shrink: 0;
    }
    
    .balance-equivalents {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    
    .balance-equivalent {
      background: rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-md);
      padding: 0.4rem 0.6rem;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      backdrop-filter: blur(5px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      white-space: nowrap;
    }
    
    .exchange-rate {
      background: rgba(255, 255, 255, 0.15);
      border-radius: var(--radius-md);
      padding: 0.4rem 0.6rem;
      font-size: 0.75rem;
      margin-bottom: 0.75rem;
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }
    
    .balance-date {
      font-size: 0.7rem;
      opacity: 0.7;
      margin-bottom: 1rem;
    }
    
    .balance-actions {
      display: flex;
      gap: 0.75rem;
      margin-top: 0.75rem;
    }
    
    .balance-btn {
      flex: 1;
      border: none;
      border-radius: var(--radius-md);
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.8rem;
      background: rgba(255,255,255,0.15);
      color: white;
      cursor: pointer;
      transition: all 0.3s var(--animation-bounce);
      backdrop-filter: blur(5px);
      white-space: nowrap;
    }
    
    .balance-btn:hover {
      background: rgba(255,255,255,0.25);
      transform: translateY(-3px);
    }
    
    .balance-btn:active {
      transform: translateY(0);
    }
    
    .balance-btn i {
      margin-right: 6px;
      font-size: 0.9rem;
    }
    
    /* Pending transactions badge */
    .pending-transaction-badge {
      background: rgba(255, 173, 51, 0.2);
      border-left: 3px solid var(--warning);
      border-radius: var(--radius-md);
      padding: 0.6rem;
      margin-top: 0.6rem;
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .pending-transaction-badge i {
      color: var(--warning);
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    
    /* Dashboard Layout */
    .app-container {
      padding-top: 70px;
      padding-bottom: 70px;
      max-width: 100%;
      margin: 0 auto;
      height: 100vh;
      overflow-y: auto;
      overflow-x: hidden;
      position: relative;
    }
    
    .dashboard-content {
      padding: 0.75rem;
      max-width: 1200px;
      margin: 0 auto;
    }
   
    /* Sections */
    .section-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--neutral-900);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .section-title i {
      margin-right: 0.5rem;
      color: var(--primary);
    }
    
    .section-title a {
      font-size: 0.7rem;
      color: var(--primary);
      text-decoration: none;
    }
    
    /* Cards */
    .card {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      padding: 1rem;
      margin-bottom: 1.25rem;
      transition: transform 0.3s var(--animation-bounce), box-shadow 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }
    
    /* Transactions */
    .transaction-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .transaction-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: var(--neutral-100);
      border-radius: var(--radius-md);
      transition: all 0.3s ease;
      box-shadow: var(--shadow-sm);
    }
    
    .transaction-item:hover {
      background: var(--neutral-200);
      transform: translateX(5px);
      box-shadow: var(--shadow-md);
    }
    
    .transaction-icon {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      flex-shrink: 0;
    }
    
    .transaction-icon.deposit {
      background: var(--success);
      color: white;
    }
    
    .transaction-icon.withdraw {
      background: var(--danger);
      color: white;
    }
    
    .transaction-icon.transfer {
      background: var(--primary-light);
      color: white;
    }
    
    .transaction-icon.pending {
      background: var(--warning);
      color: white;
    }
    
    .transaction-content {
      flex: 1;
      min-width: 0;
    }
    
    .transaction-title {
      font-weight: 600;
      font-size: 0.8rem;
      color: var(--neutral-900);
      margin-bottom: 0.125rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .transaction-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.125rem 0.375rem;
      border-radius: var(--radius-sm);
      font-size: 0.6rem;
      font-weight: 600;
      text-transform: uppercase;
      margin-top: 1px;
    }
    
    .transaction-badge.pending {
      background: rgba(255, 173, 51, 0.15);
      color: var(--warning);
    }
    
    .transaction-badge.processing {
      background: rgba(0, 149, 255, 0.15);
      color: var(--info);
    }
    
    .transaction-details {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.5rem;
      font-size: 0.7rem;
      color: var(--neutral-600);
    }
    
    .transaction-date {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .transaction-date i {
      font-size: 0.7rem;
    }
    
    .transaction-category {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .transaction-category i {
      font-size: 0.7rem;
    }
    
    .transaction-amount {
      font-weight: 600;
      font-size: 0.8rem;
      white-space: nowrap;
      flex-shrink: 0;
    }
    
    .transaction-amount.deposit {
      color: var(--success);
    }
    
    .transaction-amount.withdraw {
      color: var(--danger);
    }
    
    .transaction-amount.pending {
      color: var(--warning);
    }
    
    /* Navigation Bar */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      display: flex;
      justify-content: space-around;
      padding: 0.5rem 0;
      box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.05);
      z-index: 900;
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      padding: 0.4rem;
      border-radius: var(--radius-md);
      transition: var(--transition-base);
      cursor: pointer;
      flex: 1;
    }
    
    .nav-item.active {
      color: var(--primary);
    }
    
    .nav-icon {
      font-size: 1.1rem;
      transition: transform 0.3s var(--animation-bounce);
    }
    
    .nav-item:hover .nav-icon {
      transform: translateY(-3px);
    }
    
    .nav-label {
      font-size: 0.6rem;
      font-weight: 600;
    }

    /* Service Overlay */
    .service-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .service-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
    }

    .service-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .service-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .service-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .service-close:hover {
      background: var(--neutral-300);
    }

    .service-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .service-item {
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      transition: all 0.3s var(--animation-bounce);
      text-align: center;
    }

    .service-item:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-md);
    }

    .service-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
    }

    .service-icon.bills {
      background: var(--secondary);
    }

    .service-icon.dollar {
      background: var(--success);
    }

    .service-icon.zelle {
      background: var(--info);
    }

    .service-icon.exchange {
      background: var(--accent);
      color: var(--neutral-900);
    }

    .service-icon.reviews {
      background: var(--warning);
    }

    .service-icon.chat {
      background: var(--primary-light);
    }

    .service-name {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--neutral-900);
    }

    .service-description {
      font-size: 0.7rem;
      color: var(--neutral-600);
    }

    /* Cards Overlay */
    .cards-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .card-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .card-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .card-close:hover {
      background: var(--neutral-300);
    }

    .virtual-card {
      background: var(--card-gradient);
      border-radius: var(--radius-lg);
      height: 200px;
      width: 100%;
      max-width: 350px;
      margin: 0 auto 1.5rem;
      padding: 1.25rem;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
      color: white;
    }

    .virtual-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      animation: shine 3s infinite;
    }

    .card-logo {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 2rem;
    }

    .card-chip {
      width: 40px;
      height: auto;
      flex-shrink: 0;
    }

    .card-brand {
      width: 55px;
      height: auto;
      flex-shrink: 0;
    }

    .card-number {
      font-size: 1.25rem;
      letter-spacing: 1px;
      margin-bottom: 1.25rem;
      font-family: monospace;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .card-details {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
    }

    .card-apps {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1.5rem;
      margin-bottom: 2rem;
    }

    .card-app {
      width: 46px;
      height: 46px;
      border-radius: var(--radius-md);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: var(--neutral-800);
    }

    .card-text {
      text-align: center;
      font-size: 0.9rem;
      color: var(--neutral-600);
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    /* Messages Overlay */
    .messages-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .messages-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
    }

    .messages-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .messages-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .messages-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .messages-close:hover {
      background: var(--neutral-300);
    }

    .message-item {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      border-radius: var(--radius-md);
      background: var(--neutral-200);
      margin-bottom: 1rem;
    }

    .message-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      flex-shrink: 0;
    }

    .message-icon.welcome {
      background: var(--success);
    }

    .message-icon.verify {
      background: var(--warning);
    }

    .message-icon.security {
      background: var(--info);
    }

    .message-content {
      flex: 1;
    }

    .message-title {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
      color: var(--neutral-900);
    }

    .message-text {
      font-size: 0.8rem;
      color: var(--neutral-600);
    }

    .message-time {
      font-size: 0.7rem;
      color: var(--neutral-500);
      margin-top: 0.5rem;
    }

    /* Settings Overlay */
    .settings-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .settings-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--neutral-100);
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
      padding: 1.5rem;
      animation: slideUp 0.4s ease;
      max-height: 80vh;
      overflow-y: auto;
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .settings-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .settings-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
    }

    .settings-close:hover {
      background: var(--neutral-300);
    }
    
    /* Login Page */
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      background: var(--neutral-200);
      background-image: linear-gradient(135deg, rgba(26, 31, 113, 0.05) 0%, rgba(26, 31, 113, 0.02) 100%);
    }
    
    .login-card {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      padding: 1.5rem;
      width: 100%;
      max-width: 400px;
      animation: fadeIn 0.5s ease;
    }
    
    .login-logo {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-bottom: 1.5rem;
    }
    
    .login-logo-container {
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
    }
    
    .login-logo img {
      height: 45px;
      width: auto;
      object-fit: contain;
    }
    
    .login-heading {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    
    .login-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }
    
    .login-subtitle {
      font-size: 0.85rem;
      color: var(--neutral-600);
    }
    
    .form-group {
      margin-bottom: 1.25rem;
    }
    
    .form-label {
      display: block;
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--neutral-700);
      margin-bottom: 0.5rem;
    }
    
    .form-control {
      width: 100%;
      height: 44px;
      padding: 0 1rem;
      border: 1px solid var(--neutral-400);
      border-radius: var(--radius-md);
      font-size: 0.85rem;
      color: var(--neutral-900);
      background: var(--neutral-100);
      transition: var(--transition-base);
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }
    
    .error-message {
      font-size: 0.7rem;
      color: var(--danger);
      margin-top: 0.5rem;
      display: none;
    }
    
    .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 44px;
      padding: 0 1.5rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      transition: all 0.3s var(--animation-bounce);
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
      width: 100%;
    }
    
    .btn-primary:hover {
      background: var(--primary-light);
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }
    
    .btn-primary:active {
      transform: translateY(0);
    }
    
    .btn-outline {
      background: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }
    
    .btn-outline:hover {
      background: rgba(26, 31, 113, 0.05);
      transform: translateY(-3px);
    }
    
    .btn i {
      margin-right: 0.5rem;
      font-size: 0.9rem;
    }
    
    /* OTP Verification for Card Payment */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .modal {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 1.5rem;
      animation: scaleIn 0.3s ease;
    }
    
    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
      text-align: center;
    }
    
    .modal-subtitle {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1.5rem;
      text-align: center;
    }
    
    .otp-container {
      display: flex;
      gap: 0.5rem;
      margin: 1.5rem 0;
      justify-content: center;
    }
    
    .otp-input {
      width: 40px;
      height: 48px;
      border: 1px solid var(--neutral-400);
      border-radius: var(--radius-md);
      text-align: center;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--neutral-900);
    }
    
    .otp-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }
    
    .resend-code {
      text-align: center;
      margin-top: 1rem;
      font-size: 0.8rem;
      color: var(--neutral-600);
    }
    
    .resend-code a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }
    
    /* Feature Blocked Modal */
    .feature-blocked-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      display: none;
    }

    .feature-blocked-card {
      background: var(--neutral-100);
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 1.5rem;
      animation: scaleIn 0.3s ease;
      text-align: center;
    }

    .feature-blocked-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--warning);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      margin: 0 auto 1.25rem;
    }

    .feature-blocked-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
    }

    .feature-blocked-message {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    .feature-blocked-actions {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    /* Recharge Page */
    .recharge-container {
      padding: 1rem;
      padding-top: 70px;
      padding-bottom: 70px;
      display: none;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .payment-method-tabs {
      display: flex;
      margin-bottom: 1.5rem;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 0.25rem;
    }
    
    .payment-method-tab {
      flex: 1;
      text-align: center;
      padding: 0.6rem 0.5rem;
      border-radius: var(--radius-md);
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition-base);
      white-space: nowrap;
    }
    
    .payment-method-tab.active {
      background: var(--neutral-100);
      box-shadow: var(--shadow-sm);
      color: var(--primary);
    }
    
    .payment-method-content {
      display: none;
    }
    
    .payment-method-content.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    
    .amount-select {
      width: 100%;
      height: 44px;
      padding: 0 1rem;
      border: 1px solid var(--neutral-400);
      border-radius: var(--radius-md);
      font-size: 0.85rem;
      color: var(--neutral-900);
      background: var(--neutral-100);
      margin-bottom: 1.5rem;
    }
    
    .amount-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.15);
    }
    
    .security-badge {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(26, 31, 113, 0.05);
      border-radius: var(--radius-md);
      padding: 0.75rem;
      margin-bottom: 1.25rem;
    }
    
    .security-badge-icon {
      width: 30px;
      height: 30px;
      background: var(--primary);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    
    .security-badge-content {
      flex: 1;
      min-width: 0;
    }
    
    .security-badge-title {
      font-weight: 600;
      font-size: 0.8rem;
      color: var(--neutral-900);
      margin-bottom: 0.125rem;
    }
    
    .security-badge-text {
      font-size: 0.7rem;
      color: var(--neutral-600);
      white-space: normal;
    }
    
    /* Bank Account Details */
    .bank-details {
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 1.1rem;
      margin: 1.25rem 0;
    }
    
    .bank-detail-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--neutral-300);
    }
    
    .bank-detail-row:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }
    
    .bank-detail-label {
      font-size: 0.8rem;
      color: var(--neutral-600);
      flex-shrink: 0;
      margin-right: 0.5rem;
    }
    
    .bank-detail-value {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--neutral-900);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-align: right;
      word-break: break-word;
      flex-grow: 1;
    }
    
    .copy-btn {
      background: var(--neutral-300);
      color: var(--neutral-700);
      width: 26px;
      height: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-full);
      cursor: pointer;
      transition: var(--transition-base);
      flex-shrink: 0;
    }
    
    .copy-btn:hover {
      background: var(--primary);
      color: white;
    }
    
    .bank-warning {
      background: rgba(247, 182, 0, 0.1);
      border-left: 3px solid var(--warning);
      padding: 0.75rem;
      margin-top: 1.25rem;
      border-radius: var(--radius-sm);
    }
    
    .bank-warning-title {
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--neutral-900);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .bank-warning-title i {
      color: var(--warning);
    }
    
    .bank-warning-content {
      font-size: 0.8rem;
      color: var(--neutral-700);
    }
    
    /* Receipt Upload */
    .receipt-upload {
      border: 2px dashed var(--neutral-400);
      border-radius: var(--radius-md);
      padding: 1.5rem 1rem;
      margin: 1.25rem 0;
      text-align: center;
      cursor: pointer;
      transition: var(--transition-base);
    }
    
    .receipt-upload:hover {
      border-color: var(--primary);
      background: rgba(26, 31, 113, 0.02);
    }
    
    .receipt-upload i {
      font-size: 2rem;
      color: var(--neutral-500);
      margin-bottom: 0.75rem;
    }
    
    .receipt-upload-title {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--neutral-800);
      margin-bottom: 0.4rem;
    }
    
    .receipt-upload-subtitle {
      font-size: 0.75rem;
      color: var(--neutral-600);
    }
    
    .receipt-preview {
      display: none;
      margin-top: 1.25rem;
    }
    
    .receipt-preview-container {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.8rem;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      margin-bottom: 0.75rem;
    }
    
    .receipt-preview-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .receipt-preview-content {
      flex: 1;
      min-width: 0;
    }
    
    .receipt-preview-name {
      font-weight: 600;
      font-size: 0.8rem;
      margin-bottom: 0.2rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .receipt-preview-size {
      font-size: 0.7rem;
      color: var(--neutral-600);
    }
    
    .receipt-preview-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    /* Reference Number */
    .reference-number {
      margin-top: 1.25rem;
    }
    
    /* Credit Card Form */
    .card-preview {
      width: 100%;
      max-width: 350px;
      height: 200px;
      margin: 0 auto 1.5rem;
      perspective: 1000px;
      transition: var(--transition-base);
    }
    
    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.8s;
      transform-style: preserve-3d;
    }
    
    .card-preview.-active .card-inner {
      transform: rotateY(180deg);
    }
    
    .card-front,
    .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      box-shadow: var(--shadow-lg);
    }
    
    .card-front {
      background: var(--card-gradient);
      color: white;
    }
    
    .card-back {
      background: var(--card-gradient);
      color: white;
      transform: rotateY(180deg);
    }
    
    .card-logo {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 2rem;
    }
    
    .card-chip {
      width: 40px;
      height: auto;
      flex-shrink: 0;
    }
    
    .card-brand {
      width: 55px;
      height: auto;
      flex-shrink: 0;
    }
    
    .card-number {
      font-size: 1.25rem;
      letter-spacing: 1px;
      margin-bottom: 1.25rem;
      font-family: monospace;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .card-details {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
    }
    
    .card-holder {
      text-transform: uppercase;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 65%;
    }
    
    .card-expiry {
      display: flex;
      gap: 0.25rem;
      flex-shrink: 0;
    }
    
    .card-stripe {
      height: 40px;
      background: #000;
      margin: 1rem 0;
    }
    
    .card-cvv {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      height: 40px;
      background: white;
      color: black;
      border-radius: 4px;
      padding: 0 0.75rem;
      font-size: 1rem;
      font-family: monospace;
    }
    
    .card-form {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }
    
    .card-row {
      display: flex;
      gap: 0.75rem;
    }
    
    .card-col {
      flex: 1;
    }

    .saved-card-container {
      display: none;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 1rem;
      margin-bottom: 1.5rem;
    }

    .saved-card {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .saved-card-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
    }

    .saved-card-details {
      flex: 1;
    }

    .saved-card-number {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--neutral-900);
    }

    .saved-card-type {
      font-size: 0.75rem;
      color: var(--neutral-600);
    }

    .saved-card-use {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .saved-card-checkbox {
      width: 18px;
      height: 18px;
    }
    
    /* Loading */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      display: none;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
      margin-bottom: 1.5rem;
    }
    
    .loading-text {
      color: white;
      font-size: 1rem;
      margin-bottom: 1.5rem;
      font-weight: 500;
    }
    
    .progress-bar-container {
      width: 80%;
      max-width: 280px;
      height: 8px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: var(--radius-full);
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      background: white;
      width: 0%;
      border-radius: var(--radius-full);
      transition: width 0.3s ease;
    }
    
    /* Success Animation */
    .success-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1200;
      display: none;
    }
    
    .success-card {
      background: white;
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 2rem;
      text-align: center;
      animation: scaleIn 0.3s ease;
    }
    
    .success-checkmark {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--success);
      color: white;
      font-size: 2.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      transform: scale(0);
      animation: checkmarkScale 0.5s ease forwards 0.3s;
    }
    
    .success-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards 0.8s;
    }
    
    .success-amount {
      font-size: 2.25rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 1.25rem;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards 1.1s;
    }
    
    .success-message {
      font-size: 0.9rem;
      color: var(--neutral-600);
      margin-bottom: 1.5rem;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards 1.4s;
    }
    
    .success-actions {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards 1.7s;
    }
    
    /* Verification Banner */
    .verify-banner {
      background: linear-gradient(135deg, var(--warning) 0%, #f59e0b 100%);
      border-radius: var(--radius-md);
      padding: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      margin: 1.25rem 0;
      box-shadow: var(--shadow-md);
    }
    
    .verify-icon {
      width: 36px;
      height: 36px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--warning);
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .verify-content {
      flex: 1;
      min-width: 0;
    }
    
    .verify-title {
      font-weight: 600;
      color: white;
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    
    .verify-text {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.8rem;
    }
    
    .verify-action {
      background: white;
      color: var(--warning);
      font-weight: 600;
      font-size: 0.8rem;
      padding: 0.4rem 0.75rem;
      border-radius: var(--radius-md);
      flex-shrink: 0;
      transition: all 0.3s var(--animation-bounce);
      cursor: pointer;
      border: none;
      white-space: nowrap;
    }
    
    .verify-action:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    /* Identity Verification Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      display: none;
    }
    
    /* Bank/Mobile Transfer Processing Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 70px;
      right: 16px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .toast {
      background: var(--neutral-900);
      color: white;
      border-radius: var(--radius-md);
      padding: 0.75rem 1rem;
      min-width: 250px;
      max-width: 320px;
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      animation: slideInRight 0.3s ease, fadeOut 0.3s ease 3s forwards;
    }
    
    .toast.success {
      border-left: 4px solid var(--success);
    }
    
    .toast.error {
      border-left: 4px solid var(--danger);
    }
    
    .toast.warning {
      border-left: 4px solid var(--warning);
    }
    
    .toast.info {
      border-left: 4px solid var(--info);
    }
    
    .toast-icon {
      flex-shrink: 0;
    }
    
    .toast-content {
      flex: 1;
      min-width: 0;
    }
    
    .toast-title {
      font-weight: 600;
      font-size: 0.85rem;
      margin-bottom: 0.2rem;
    }
    
    .toast-message {
      font-size: 0.75rem;
      opacity: 0.9;
      word-wrap: break-word;
    }
    
    .toast-close {
      color: var(--neutral-400);
      cursor: pointer;
      transition: var(--transition-base);
      flex-shrink: 0;
    }
    
    .toast-close:hover {
      color: white;
    }
    
    /* Inactivity Modal */
    .inactivity-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .inactivity-card {
      background: white;
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 320px;
      padding: 1.5rem;
      text-align: center;
      animation: scaleIn 0.3s ease;
    }
    
    .inactivity-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--warning);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      margin: 0 auto 1.25rem;
    }
    
    .inactivity-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.75rem;
    }
    
    .inactivity-message {
      font-size: 0.85rem;
      color: var(--neutral-600);
      margin-bottom: 1.25rem;
    }
    
    .inactivity-timer {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--danger);
      margin-bottom: 1.25rem;
    }
    
    .inactivity-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    /* Welcome Modal */
    .welcome-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1200;
      display: none;
    }
    
    .welcome-card {
      background: white;
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 380px;
      padding: 1.5rem;
      animation: scaleIn 0.3s ease;
    }
    
    .welcome-header {
      display: flex;
      align-items: center;
      gap: 1.25rem;
      margin-bottom: 1.25rem;
    }
    
    .welcome-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      flex-shrink: 0;
    }
    
    .welcome-title-container {
      flex: 1;
      min-width: 0;
    }
    
    .welcome-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-900);
      margin-bottom: 0.25rem;
    }
    
    .welcome-subtitle {
      font-size: 0.85rem;
      color: var(--neutral-600);
    }
    
    .welcome-content {
      margin-bottom: 1.5rem;
    }
    
    .welcome-step {
      display: flex;
      gap: 0.75rem;
      align-items: flex-start;
      margin-bottom: 1.25rem;
    }
    
    .welcome-step-icon {
      width: 28px;
      height: 28px;
      border-radius: var(--radius-full);
      background: var(--primary-light);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    
    .welcome-step-content {
      flex: 1;
    }
    
    .welcome-step-title {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--neutral-900);
      margin-bottom: 0.25rem;
    }
    
    .welcome-step-description {
      font-size: 0.8rem;
      color: var(--neutral-600);
    }

    /* Contact Section */
    .contact-options {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 1.25rem;
    }
    
    .contact-option {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.9rem;
      background: var(--neutral-200);
      border-radius: var(--radius-md);
      transition: all 0.3s ease;
      text-decoration: none;
      color: var(--neutral-900);
    }
    
    .contact-option:hover {
      background: var(--neutral-300);
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }
    
    .contact-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      flex-shrink: 0;
      color: white;
    }
    
    .contact-icon.whatsapp {
      background: #25D366;
    }
    
    .contact-icon.email {
      background: var(--primary);
    }

    .contact-icon.chat {
      background: var(--info);
    }

    .contact-icon.reviews {
      background: var(--warning);
    }
    
    .contact-content {
      flex: 1;
      min-width: 0;
    }
    
    .contact-title {
      font-weight: 600;
      font-size: 0.85rem;
      margin-bottom: 0.2rem;
    }
    
    .contact-description {
      font-size: 0.75rem;
      color: var(--neutral-600);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* Tawk.to */
    .tawkto-container {
      position: fixed;
      z-index: 1200;
      bottom: 20px;
      right: 20px;
      visibility: visible !important;
      display: block !important;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes checkmarkScale {
      from { transform: scale(0); }
      to { transform: scale(1); }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; visibility: hidden; }
    }

    @keyframes slideUp {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    /* Custom toggle switch */
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--neutral-400);
      transition: .4s;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
    }
    
    input:checked + .slider {
      background-color: var(--primary);
    }
    
    input:focus + .slider {
      box-shadow: 0 0 1px var(--primary);
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    
    .slider.round {
      border-radius: 24px;
    }
    
    .slider.round:before {
      border-radius: 50%;
    }
    
    /* Responsive Styles */
    @media (min-width: 480px) {      
      .users-online-badge {
        display: flex;
      }
      
      .saved-card-container {
        padding: 1.25rem;
      }
    }
    
    @media (min-width: 768px) {
      .app-container {
        max-width: 100%;
      }
      
      .dashboard-content {
        padding: 1.25rem;
      }
      
      .header-brand-text {
        display: block;
      }
      
      .balance-amount {
        font-size: 2.25rem;
      }
      
      .balance-btn {
        height: 44px;
        font-size: 0.85rem;
      }

      .service-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (min-width: 1024px) {
      .dashboard-content {
        padding: 1.5rem;
      }
    }

    /* Botn para procesar directamente el pago con tarjeta guardada */
    .saved-card-pay-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      padding: 0.8rem 1rem;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s var(--animation-bounce);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1rem;
      width: 100%;
    }
    
    .saved-card-pay-btn:hover {
      background: var(--primary-light);
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }
    
    .saved-card-pay-btn:active {
      transform: translateY(0);
    }

    /* Primera recarga - Banner */
    .first-recharge-banner {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      border-radius: var(--radius-md);
      padding: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      margin: 1.25rem 0;
      box-shadow: var(--shadow-md);
    }
    
    .first-recharge-icon {
      width: 36px;
      height: 36px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .first-recharge-content {
      flex: 1;
      min-width: 0;
    }
    
    .first-recharge-title {
      font-weight: 600;
      color: white;
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    
    .first-recharge-text {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.8rem;
    }
    
    .first-recharge-action {
      background: white;
      color: var(--primary);
      font-weight: 600;
      font-size: 0.8rem;
      padding: 0.4rem 0.75rem;
      border-radius: var(--radius-md);
      flex-shrink: 0;
      transition: all 0.3s var(--animation-bounce);
      cursor: pointer;
      border: none;
      white-space: nowrap;
    }
    
    .first-recharge-action:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    /* Notificacin de seguridad */
    .security-notice-banner {
      background: rgba(0, 149, 255, 0.1);
      border-left: 3px solid var(--info);
      border-radius: var(--radius-md);
      padding: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      margin: 1.25rem 0;
      box-shadow: var(--shadow-sm);
    }
    
    .security-notice-icon {
      width: 36px;
      height: 36px;
      background: var(--info);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .security-notice-content {
      flex: 1;
      min-width: 0;
    }
    
    .security-notice-title {
      font-weight: 600;
      color: var(--neutral-900);
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    
    .security-notice-text {
      color: var(--neutral-700);
      font-size: 0.8rem;
    }
  </style>
</head>

<body>
  <!-- Login Section -->
  <div class="login-container" id="login-container">
    <div class="login-card">
      <div class="login-logo">
        <div class="login-logo-container">
          <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png" alt="REMEEX">
        </div>
      </div>
      
      <div class="login-heading">
        <h1 class="login-title">Bienvenido</h1>
        <p class="login-subtitle" id="login-subtitle">Ingrese sus datos para acceder a su cuenta</p>
      </div>
      
      <div class="security-badge">
        <div class="security-badge-icon">
          <i class="fas fa-shield-alt"></i>
        </div>
        <div class="security-badge-content">
          <div class="security-badge-title">Conexin segura</div>
          <div class="security-badge-text">Sus datos estn protegidos con cifrado de nivel bancario</div>
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label" for="login-name">Nombre Completo</label>
        <input type="text" class="form-control" id="login-name" placeholder="Ej: Juan Prez" aria-describedby="name-error">
        <div class="error-message" id="name-error">Por favor, introduce tu nombre y apellido (solo letras).</div>
      </div>
      
      <div class="form-group">
        <label class="form-label" for="login-email">Correo Electrnico</label>
        <input type="email" class="form-control" id="login-email" placeholder="ejemplo@correo.com" aria-describedby="email-error">
        <div class="error-message" id="email-error">Por favor, introduce un correo electrnico vlido.</div>
      </div>
      
      <div class="form-group">
        <label class="form-label" for="login-code">Clave de 20 dgitos</label>
        <input type="password" class="form-control" id="login-code" placeholder="Enviada a tu correo electrnico" aria-describedby="code-error">
        <div class="error-message" id="code-error">La clave debe tener 20 dgitos.</div>
      </div>
      
      <button class="btn btn-primary" id="login-button">
        <i class="fas fa-sign-in-alt"></i> Iniciar Sesin
      </button>
      
      <div style="text-align: center; margin-top: 1.5rem;">
        <a href="https://wa.me/+17373018059" class="btn btn-outline" target="_blank" style="display: inline-flex; margin: 0 auto;">
          <i class="fab fa-whatsapp"></i> Contactar Soporte
        </a>
      </div>
    </div>
  </div>

  <!-- App Header (only visible after login) -->
  <header class="app-header" id="app-header" style="display: none;">
    <div class="header-brand">
      <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png" alt="REMEEX">
    </div>
    
    <div class="header-actions">
      <div class="users-online-badge">
        <div class="pulse-dot"></div>
        <span id="users-online-count">124 usuarios conectados</span>
      </div>
      
      <button class="header-action-btn" id="notification-btn" aria-label="Notificaciones">
        <i class="fas fa-bell"></i>
        <span class="notification-badge">3</span>
      </button>
    </div>
  </header>

  <!-- Dashboard Container -->
  <div class="app-container" id="dashboard-container" style="display: none;">
    <div class="dashboard-content">
      <!-- Home Section -->
      <div id="home-section">
        <!-- Main Account Card -->
        <div class="balance-card">
          <div class="card-decoration"></div>
          <div class="card-decoration"></div>
          <div class="balance-content">
            <div class="balance-header">
              <div class="balance-label">
                <i class="fas fa-shield-alt"></i>
                <span id="balance-label-name">Saldo Disponible</span>
              </div>
              <div class="header-avatar" id="header-avatar">JP</div>
            </div>
            
            <div class="balance-amount" id="dashboard-balance">
              <img src="https://upload.wikimedia.org/wikipedia/commons/0/06/Flag_of_Venezuela.svg" class="currency-flag" id="main-currency-flag" alt="Bandera de Venezuela">
              <span id="main-currency-symbol">Bs</span>
              <span id="main-balance-value">0,00</span>
            </div>
            
            <div class="balance-equivalents">
              <div class="balance-equivalent">
                <img src="https://flagcdn.com/us.svg" class="currency-flag" alt="Bandera de EEUU">
                <span> $0.00</span>
              </div>
              <div class="balance-equivalent">
                <img src="https://upload.wikimedia.org/wikipedia/commons/b/b7/Flag_of_Europe.svg" class="currency-flag" alt="Bandera de la Unin Europea">
                <span> 0.00</span>
              </div>
            </div>
            
            <div class="exchange-rate" id="exchange-rate">
              <i class="fas fa-exchange-alt"></i> <span id="exchange-rate-display">Tasa: 1 USD = 112.00 Bs | 1 USD = 0.94 EUR</span>
            </div>
            
            <div class="balance-date" id="balance-date">Domingo, 4 de Mayo de 2025</div>
            
            <!-- Pending Transaction Badge (hidden by default) -->
            <div class="pending-transaction-badge" id="pending-transaction-badge" style="display: none;">
              <i class="fas fa-clock"></i>
              <div>
                <div style="font-weight: 600; margin-bottom: 0.125rem;">Transaccin pendiente</div>
                <div id="pending-transaction-amount">$0.00 en proceso de verificacin</div>
              </div></div>
            
            <div class="balance-actions">
              <button class="balance-btn" id="recharge-btn">
                <i class="fas fa-plus-circle"></i> Recargar Saldo
              </button>
              <button class="balance-btn" id="receive-btn">
                <i class="fas fa-download"></i> Recibir Dinero
              </button>
              <button class="balance-btn" id="send-btn">
                <i class="fas fa-paper-plane"></i> Enviar Dinero
              </button>
            </div>
          </div>
        </div>
        
        <!-- Banner de seguridad de dispositivo nico -->
        <div class="security-notice-banner" id="security-device-notice">
          <div class="security-notice-icon">
            <i class="fas fa-lock"></i>
          </div>
          <div class="security-notice-content">
            <div class="security-notice-title">Acceso Exclusivo a este Dispositivo</div>
            <div class="security-notice-text">Por su seguridad, su saldo y transacciones solo estn disponibles en este dispositivo donde ha iniciado sesin.</div>
          </div>
        </div>
        
        <!-- Verification Banner (if not verified) -->
        <div class="verify-banner" id="dashboard-verify-banner" style="display: none;">
          <div class="verify-icon">
            <i class="fas fa-id-card"></i>
          </div>
          <div class="verify-content">
            <div class="verify-title">Verificacin de Identidad Requerida</div>
            <div class="verify-text">Para una mayor seguridad y acceso completo a todas las funciones, verifique su identidad.</div>
          </div>
          <button class="verify-action" id="dashboard-verify-action">Verificar</button>
        </div>

        <!-- First Recharge Banner (if no recharges yet) -->
        <div class="first-recharge-banner" id="first-recharge-banner" style="display: none;">
          <div class="first-recharge-icon">
            <i class="fas fa-credit-card"></i>
          </div>
          <div class="first-recharge-content">
            <div class="first-recharge-title">Haz tu primera recarga!</div>
            <div class="first-recharge-text">Comienza a utilizar todos los servicios recargando con tarjeta de crdito.</div>
          </div>
          <button class="first-recharge-action" id="first-recharge-action">Recargar</button>
         </div><!-- Recent Transactions -->
        <div class="card">
          <div class="section-title" style="margin-bottom: 0.5rem;">
            <i class="fas fa-history"></i> Transacciones Recientes
            <a href="#" id="view-all-transactions">Ver todas</a>
          </div>
          
          <div class="transaction-list" id="recent-transactions">
            <!-- Will be populated by JavaScript -->
          </div>
        </div>
        
        <!-- Contact Section -->
        <div class="card">
          <div class="section-title" style="margin-bottom: 1rem;">
            <i class="fas fa-headset"></i> Soporte y Ayuda
          </div>
          
          <div class="contact-options">
            <a href="https://wa.me/+17373018059" class="contact-option" target="_blank">
              <div class="contact-icon whatsapp">
                <i class="fab fa-whatsapp"></i>
              </div>
              <div class="contact-content">
                <div class="contact-title">WhatsApp</div>
                <div class="contact-description">Atencin 24/7 va chat</div>
              </div>
            </a>
            
            <a href="mailto:contactcenter@visa.com" class="contact-option">
              <div class="contact-icon email">
                <i class="fas fa-envelope"></i>
              </div>
              <div class="contact-content">
                <div class="contact-title">Correo Electrnico</div>
                <div class="contact-description">contactcenter@visa.com</div>
              </div>
            </a>

            <a href="fororemeex.html" class="contact-option">
              <div class="contact-icon chat">
                <i class="fas fa-comments"></i>
              </div>
              <div class="contact-content">
                <div class="contact-title">Chat con Usuarios</div>
                <div class="contact-description">Conctate con la comunidad</div>
              </div>
            </a>
          
            <a href="opinionesremeex.html" class="contact-option">
              <div class="contact-icon reviews">
                <i class="fas fa-star"></i>
              </div>
              <div class="contact-content">
                <div class="contact-title">Opiniones</div>
                <div class="contact-description">Experiencias de usuarios</div>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav" id="bottom-nav" style="display: none;">
    <div class="nav-item" data-section="services">
      <div class="nav-icon"><i class="fas fa-list-alt"></i></div>
      <div class="nav-label">Servicios</div>
    </div>
    
    <div class="nav-item" data-section="cards">
      <div class="nav-icon"><i class="fas fa-credit-card"></i></div>
      <div class="nav-label">Tarjetas</div>
    </div>
    
    <div class="nav-item active" data-section="home">
      <div class="nav-icon"><i class="fas fa-home"></i></div>
      <div class="nav-label">Inicio</div>
    </div>
    
    <div class="nav-item" data-section="messages">
      <div class="nav-icon"><i class="fas fa-envelope"></i></div>
      <div class="nav-label">Mensajes</div>
    </div>

    <div class="nav-item" data-section="settings">
      <div class="nav-icon"><i class="fas fa-cog"></i></div>
      <div class="nav-label">Ajustes</div>
    </div>
  </nav>

  <!-- Service Overlay -->
  <div class="service-overlay" id="service-overlay">
    <div class="service-container">
      <div class="service-header">
        <div class="service-title">Servicios</div>
        <div class="service-close" id="service-close"><i class="fas fa-times"></i></div>
      </div>
      <div class="service-grid">
        <div class="service-item" id="service-bills">
          <div class="service-icon bills">
            <i class="fas fa-file-invoice"></i>
          </div>
          <div class="service-name">Pago de Servicios</div>
          <div class="service-description">Luz, agua, telfono</div>
        </div>
        
        <div class="service-item" id="service-dollar">
          <div class="service-icon dollar">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="service-name">Cuenta en Dlares</div>
          <div class="service-description">Apertura inmediata</div>
        </div>
        
        <div class="service-item" id="service-zelle">
          <div class="service-icon zelle">
            <i class="fas fa-university"></i>
          </div>
          <div class="service-name">Activar Zelle</div>
          <div class="service-description">Pagos internacionales</div>
        </div>
        
        <div class="service-item" id="service-exchange">
          <div class="service-icon exchange">
            <i class="fas fa-exchange-alt"></i>
          </div>
          <div class="service-name">Cambio de Divisas</div>
          <div class="service-description">Mejores tasas</div>
        </div>
        
        <div class="service-item" id="service-reviews">
          <div class="service-icon reviews">
            <i class="fas fa-star"></i>
          </div>
          <div class="service-name">Opiniones</div>
          <div class="service-description">Experiencias de usuarios</div>
        </div>
        
        <div class="service-item" id="service-chat">
          <div class="service-icon chat">
            <i class="fas fa-comments"></i>
          </div>
          <div class="service-name">Chat en Vivo</div>
          <div class="service-description">Soporte 24/7</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cards Overlay -->
  <div class="cards-overlay" id="cards-overlay">
    <div class="card-container">
      <div class="card-header">
        <div class="card-title">Tarjeta Virtual VISA</div>
        <div class="card-close" id="card-close"><i class="fas fa-times"></i></div>
      </div>
      
      <div class="virtual-card">
        <div class="card-logo">
          <img src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/chip.png" class="card-chip" alt="Chip de tarjeta">
          <img src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/visa.png" class="card-brand" alt="Logo de Visa">
        </div>
        
        <div class="card-number">   </div>
        
        <div class="card-details">
          <div style="opacity: 0.7;">Verificacin requerida</div>
        </div>
      </div>
      
      <div class="card-apps">
        <div class="card-app"><i class="fab fa-amazon"></i></div>
        <div class="card-app"><i class="fab fa-apple"></i></div>
        <div class="card-app"><i class="fab fa-paypal"></i></div>
        <div class="card-app"><i class="fab fa-spotify"></i></div>
        <div class="card-app"><i class="fab fa-google-play"></i></div>
        <div class="card-app"><i class="fab fa-netflix"></i></div>
      </div>
      
      <div class="card-text">
        Para obtener su tarjeta virtual VISA y poder realizar compras en lnea de forma segura, necesita verificar su identidad. Una vez verificado, podr generar tarjetas virtuales para usar en Amazon, PayPal, Binance, Zinli y otras plataformas.
      </div>
      
      <button class="btn btn-primary" id="verify-for-card">
        <i class="fas fa-id-card"></i> Verificar mi Identidad
      </button>
    </div>
  </div>

  <!-- Messages Overlay -->
  <div class="messages-overlay" id="messages-overlay">
    <div class="messages-container">
      <div class="messages-header">
        <div class="messages-title">Notificaciones</div>
        <div class="messages-close" id="messages-close"><i class="fas fa-times"></i></div>
      </div>
      
      <div class="message-item">
        <div class="message-icon welcome">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="message-content">
          <div class="message-title">Bienvenido a REMEEX</div>
          <div class="message-text">Su cuenta ha sido creada con xito! Comience a disfrutar de nuestros servicios de forma inmediata.</div>
          <div class="message-time">Hoy, 10:30 AM</div>
        </div>
      </div>
      
      <div class="message-item">
        <div class="message-icon security">
          <i class="fas fa-lock"></i>
        </div>
        <div class="message-content">
          <div class="message-title">Acceso exclusivo a este dispositivo</div>
          <div class="message-text">Por su seguridad, su saldo y transacciones solo estn disponibles en el dispositivo donde ha iniciado sesin.</div>
          <div class="message-time">Hoy, 10:31 AM</div>
        </div>
      </div>
      
      <div class="message-item">
        <div class="message-icon verify">
          <i class="fas fa-exclamation-circle"></i>
        </div>
        <div class="message-content">
          <div class="message-title">Verificacin pendiente</div>
          <div class="message-text">Para desbloquear todas las funcionalidades y aumentar sus lmites de transaccin, complete la verificacin de su identidad.</div>
          <div class="message-time">Hoy, 10:32 AM</div>
        </div>
      </div>
      
      <div class="message-item">
        <div class="message-icon security">
          <i class="fas fa-shield-alt"></i>
        </div>
        <div class="message-content">
          <div class="message-title">Seguridad de su cuenta</div>
          <div class="message-text">Para mayor seguridad, le recomendamos activar la autenticacin de dos factores en su perfil.</div>
          <div class="message-time">Hoy, 10:35 AM</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Overlay -->
  <div class="settings-overlay" id="settings-overlay">
    <div class="settings-container">
      <div class="settings-header">
        <div class="settings-title">Configuracin</div>
        <div class="settings-close" id="settings-close"><i class="fas fa-times"></i></div>
      </div>
      
      <div class="card" style="margin-bottom: 1rem;">
        <div class="section-title" style="margin-bottom: 1rem;">
          <i class="fas fa-user"></i> Informacin de Cuenta
        </div>
        
        <div class="form-group">
          <label class="form-label" for="settings-name">Nombre Completo</label>
          <input type="text" class="form-control" id="settings-name" disabled>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="settings-email">Correo Electrnico</label>
          <input type="email" class="form-control" id="settings-email" disabled>
        </div>
      </div>
      
      <div class="card" style="margin-bottom: 1rem;">
        <div class="section-title" style="margin-bottom: 1rem;">
          <i class="fas fa-bell"></i> Notificaciones
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 1rem;">
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>Notificaciones por correo</div>
            <label class="switch">
              <input type="checkbox" checked>
              <span class="slider round"></span>
            </label>
          </div>
          
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>Notificaciones por SMS</div>
            <label class="switch">
              <input type="checkbox" checked>
              <span class="slider round"></span>
            </label>
          </div>
          
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>Alertas de seguridad</div>
            <label class="switch">
              <input type="checkbox" checked>
              <span class="slider round"></span>
            </label>
          </div>
        </div>
      </div>
      
      <div class="card" style="margin-bottom: 1rem;">
        <div class="section-title" style="margin-bottom: 1rem;">
          <i class="fas fa-shield-alt"></i> Seguridad
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1rem;">
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>Autenticacin de dos factores</div>
            <label class="switch">
              <input type="checkbox">
              <span class="slider round"></span>
            </label>
          </div>
          
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>Notificaciones de inicio de sesin</div>
            <label class="switch">
              <input type="checkbox" checked>
              <span class="slider round"></span>
            </label>
          </div>
        </div>
        
        <button class="btn btn-primary" id="verify-identity-btn">
          <i class="fas fa-id-card"></i> Verificar mi Identidad
        </button>
      </div>

      <button class="btn btn-primary" id="logout-btn" style="margin-top: 1rem;">
        <i class="fas fa-sign-out-alt"></i> Cerrar Sesin
      </button>
    </div>
  </div>

  <!-- Recharge Container -->
  <div class="recharge-container" id="recharge-container">
    <div class="section-title" style="margin-bottom: 1.5rem; display: flex; align-items: center;">
      <i class="fas fa-arrow-left" id="recharge-back" style="cursor: pointer; margin-right: 1rem;"></i>
      <span>Recargar Saldo</span>
    </div>
    
    <div class="security-badge" style="margin-bottom: 1.5rem;">
      <div class="security-badge-icon">
        <i class="fas fa-lock"></i>
      </div>
      <div class="security-badge-content">
        <div class="security-badge-title">Transaccin Segura</div>
        <div class="security-badge-text">Todos los pagos estn protegidos con cifrado SSL</div>
      </div>
    </div>

    <div class="payment-method-tabs">
      <div class="payment-method-tab active" data-target="card-payment">Tarjeta de Crdito</div>
      <div class="payment-method-tab" data-target="bank-payment">Transferencia Bancaria</div>
      <div class="payment-method-tab" data-target="mobile-payment">Pago Mvil</div>
    </div>

    <!-- Credit Card Payment Method -->
    <div class="payment-method-content active" id="card-payment">
      <div class="card">
        <div style="margin-bottom: 1.25rem; text-align: center;">
          <div style="font-size: 0.8rem; color: var(--neutral-600); margin-bottom: 0.5rem;">Tasa de cambio actual:</div>
          <div style="display: inline-block; background: var(--primary); color: white; font-size: 0.8rem; font-weight: 600; padding: 0.5rem 0.75rem; border-radius: var(--radius-md);">
            <span id="card-exchange-rate-display">1 USD = 112.00 Bs | 1 USD = 0.94 EUR</span>
          </div>
        </div>

        <!-- Saved Card Container (initially hidden) -->
        <div class="saved-card-container" id="saved-card-container">
          <div class="saved-card">
            <div class="saved-card-icon">
              <i class="fab fa-cc-visa"></i>
            </div>
            <div class="saved-card-details">
              <div class="saved-card-number">   3009</div>
              <div class="saved-card-type">VISA</div>
            </div>
            <div class="saved-card-use">
              <input type="checkbox" id="use-saved-card" class="saved-card-checkbox" checked>
              <label for="use-saved-card">Usar esta tarjeta</label>
            </div>
          </div>
          <!-- Botn para pagar directamente con tarjeta guardada -->
          <button class="saved-card-pay-btn" id="saved-card-pay-btn">
            <i class="fas fa-credit-card"></i> Recargar con tarjeta guardada
          </button>
        </div>
        
        <div class="section-title" style="margin-bottom: 0.5rem; font-size: 0.9rem;">
          <i class="fas fa-money-bill"></i> Seleccione un Monto
        </div>
        
        <select class="amount-select" id="card-amount-select">
          <option value="500" data-bs="56000" data-eur="470">$500  Bs 56.000,00  470,00</option>
          <option value="1000" data-bs="112000" data-eur="940">$1.000  Bs 112.000,00  940,00</option>
          <option value="1500" data-bs="168000" data-eur="1410">$1.500  Bs 168.000,00  1.410,00</option>
          <option value="2000" data-bs="224000" data-eur="1880">$2.000  Bs 224.000,00  1.880,00</option>
          <option value="3000" data-bs="336000" data-eur="2820">$3.000  Bs 336.000,00  2.820,00</option>
          <option value="4000" data-bs="448000" data-eur="3760">$4.000  Bs 448.000,00  3.760,00</option>
          <option value="5000" data-bs="560000" data-eur="4700">$5.000  Bs 560.000,00  4.700,00</option>
          <option value="6000" data-bs="672000" data-eur="5640">$6.000  Bs 672.000,00  5.640,00</option>
          <option value="7000" data-bs="784000" data-eur="6580">$7.000  Bs 784.000,00  6.580,00</option>
          <option value="8000" data-bs="896000" data-eur="7520">$8.000  Bs 896.000,00  7.520,00</option>
        </select>
      </div>
      
      <div class="card" id="card-form-container" style="margin-top: 1.5rem;">
        <div class="section-title" style="margin-bottom: 1rem;">
          <i class="fas fa-credit-card"></i> Detalles de la Tarjeta
        </div>
        
        <div class="card-preview" id="card-preview">
          <div class="card-inner">
            <div class="card-front">
              <div class="card-logo">
                <img src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/chip.png" class="card-chip" alt="Chip de tarjeta">
                <img id="card-brand-logo" src="https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/visa.png" class="card-brand" alt="Logo de Visa">
              </div>
              
              <div class="card-number" id="card-number-display">   </div>
              
              <div class="card-details">
                <div class="card-holder">
                  <div style="opacity: 0.7; font-size: 0.7rem; margin-bottom: 4px;">Titular</div>
                  <div id="card-holder-display"> </div>
                </div>
                
                <div class="card-expiry">
                  <div style="text-align: right;">
                    <div style="opacity: 0.7; font-size: 0.7rem; margin-bottom: 4px;">Expira</div>
                    <div><span id="card-month-display"></span>/<span id="card-year-display"></span></div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card-back">
              <div class="card-stripe"></div>
              <div style="padding: 0 1.25rem;">
                <div style="font-size: 0.7rem; margin-bottom: 0.5rem;">CVV</div>
                <div class="card-cvv" id="card-cvv-display"></div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="card-form">
          <div class="form-group">
            <label class="form-label" for="cardName">Titular de la Tarjeta</label>
            <input type="text" class="form-control" id="cardName" placeholder="Nombre como aparece en la tarjeta" aria-describedby="card-name-error">
            <div class="error-message" id="card-name-error">Por favor, introduce el nombre del titular.</div>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="cardNumber">Nmero de Tarjeta</label>
            <input type="text" class="form-control" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" aria-describedby="card-number-error">
            <div class="error-message" id="card-number-error">Nmero de tarjeta no vlido.</div>
          </div>
          
          <div class="card-row">
            <div class="card-col">
              <label class="form-label">Fecha de Expiracin</label>
              <div style="display: flex; gap: 0.5rem;">
                <select class="form-control" id="cardMonth" aria-describedby="card-date-error">
                  <option value="" disabled selected>Mes</option>
                  <option value="01">01</option>
                  <option value="02">02</option>
                  <option value="03">03</option>
                  <option value="04">04</option>
                  <option value="05">05</option>
                  <option value="06">06</option>
                  <option value="07">07</option>
                  <option value="08">08</option>
                  <option value="09">09</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                </select>
                
                <select class="form-control" id="cardYear" aria-describedby="card-date-error">
                  <option value="" disabled selected>Ao</option>
                  <option value="2025">2025</option>
                  <option value="2026">2026</option>
                  <option value="2027">2027</option>
                  <option value="2028">2028</option>
                  <option value="2029">2029</option>
                  <option value="2030">2030</option>
                </select>
              </div>
              <div class="error-message" id="card-date-error">Por favor, selecciona una fecha vlida.</div>
            </div>
            
            <div class="card-col" style="max-width: 120px;">
              <label class="form-label" for="cardCvv">CVV</label>
              <input type="password" class="form-control" id="cardCvv" placeholder="" maxlength="3" aria-describedby="card-cvv-error">
              <div class="error-message" id="card-cvv-error">CVV invlido.</div>
            </div>
          </div>
          
          <div style="display: flex; align-items: center; margin-top: 1rem;">
            <input type="checkbox" id="save-card" style="margin-right: 0.5rem;">
            <label for="save-card" style="font-size: 0.85rem; color: var(--neutral-700);">Guardar esta tarjeta para futuras recargas</label>
          </div>
          
          <button class="btn btn-primary" id="submit-payment" style="margin-top: 1.5rem;">
            <i class="fas fa-credit-card"></i> Recargar $500
          </button>
        </div>
      </div>
    </div>

    <!-- Bank Transfer Payment Method -->
    <div class="payment-method-content" id="bank-payment">
      <div class="card">
        <div style="margin-bottom: 1.25rem; text-align: center;">
          <div style="font-size: 0.8rem; color: var(--neutral-600); margin-bottom: 0.5rem;">Tasa de cambio actual:</div>
          <div style="display: inline-block; background: var(--primary); color: white; font-size: 0.8rem; font-weight: 600; padding: 0.5rem 0.75rem; border-radius: var(--radius-md);">
            <span id="bank-exchange-rate-display">1 USD = 112.00 Bs | 1 USD = 0.94 EUR</span>
          </div>
        </div>
        
        <div class="section-title" style="margin-bottom: 0.5rem;">
          <i class="fas fa-money-bill"></i> Seleccione un Monto
        </div>
        
        <select class="amount-select" id="bank-amount-select">
          <option value="25" data-bs="2800" data-eur="23.5">$25  Bs 2.800,00  23,50</option>
          <option value="30" data-bs="3360" data-eur="28.2">$30  Bs 3.360,00  28,20</option>
          <option value="40" data-bs="4480" data-eur="37.6">$40  Bs 4.480,00  37,60</option>
          <option value="50" data-bs="5600" data-eur="47">$50  Bs 5.600,00  47,00</option>
          <option value="100" data-bs="11200" data-eur="94">$100  Bs 11.200,00  94,00</option>
          <option value="200" data-bs="22400" data-eur="188">$200  Bs 22.400,00  188,00</option>
          <option value="250" data-bs="28000" data-eur="235">$250  Bs 28.000,00  235,00</option>
          <option value="400" data-bs="44800" data-eur="376">$400  Bs 44.800,00  376,00</option>
          <option value="500" data-bs="56000" data-eur="470">$500  Bs 56.000,00  470,00</option>
        </select>
        
        <div class="section-title" style="margin-top: 1.5rem; margin-bottom: 1rem;">
          <i class="fas fa-university"></i> Datos Bancarios
        </div>
        
        <div class="bank-details">
          <div class="bank-detail-row">
            <div class="bank-detail-label">Banco:</div>
            <div class="bank-detail-value">
              Banco Venezolano de Crdito
              <div class="copy-btn" data-copy="Banco Venezolano de Crdito"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Titular:</div>
            <div class="bank-detail-value">
              Global VISA Venezuela
              <div class="copy-btn" data-copy="Global VISA Venezuela"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">RIF:</div>
            <div class="bank-detail-value">
              J407502646
              <div class="copy-btn" data-copy="J407502646"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Cuenta Corriente:</div>
            <div class="bank-detail-value">
              Disponible al activar su cuenta
              <div class="copy-btn" data-copy="No disponible"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Concepto:</div>
            <div class="bank-detail-value">
              4454651
              <div class="copy-btn" data-copy="4454651"><i class="far fa-copy"></i></div>
            </div>
          </div>
        </div>
        
        <div class="bank-warning">
          <div class="bank-warning-title">
            <i class="fas fa-exclamation-triangle"></i> Importante
          </div>
          <div class="bank-warning-content">
            Asegrese de realizar la transferencia <strong>nicamente</strong> al Banco Venezolano de Crdito. No confundir con Banco Nacional de Crdito ni Banco de Venezuela. Una vez realizada la transferencia, complete el formulario a continuacin.
          </div>
        </div>
        
        <div class="section-title" style="margin-top: 1.5rem; margin-bottom: 1rem;">
          <i class="fas fa-upload"></i> Comprobante de Pago
        </div>
        
        <div class="receipt-upload" id="receipt-upload">
          <i class="fas fa-cloud-upload-alt"></i>
          <div class="receipt-upload-title">Subir Comprobante</div>
          <div class="receipt-upload-subtitle">Haga clic aqu para cargar su comprobante de pago<br>Formatos aceptados: JPG, PNG, PDF (mx. 5MB)</div>
          <input type="file" id="receipt-file" accept="image/jpeg,image/png,application/pdf" style="display: none;">
        </div>
        
        <div class="receipt-preview" id="receipt-preview">
          <div class="receipt-preview-container">
            <div class="receipt-preview-icon">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="receipt-preview-content">
              <div class="receipt-preview-name" id="receipt-filename">comprobante.jpg</div>
              <div class="receipt-preview-size" id="receipt-filesize">120 KB</div>
            </div>
            <div class="receipt-preview-actions">
              <div class="copy-btn" id="receipt-remove"><i class="fas fa-trash"></i></div>
            </div>
          </div>
        </div>
        
        <div class="form-group reference-number">
          <label class="form-label" for="reference-number">Nmero de Referencia</label>
          <input type="text" class="form-control" id="reference-number" placeholder="Ingrese el nmero de referencia de la transferencia" aria-describedby="reference-error">
          <div class="error-message" id="reference-error">Por favor, ingrese un nmero de referencia vlido.</div>
        </div>
        
        <button class="btn btn-primary" id="submit-bank-transfer" style="margin-top: 1.5rem;">
          <i class="fas fa-paper-plane"></i> Enviar Comprobante
        </button>
      </div>
    </div>

    <!-- Mobile Payment Method -->
    <div class="payment-method-content" id="mobile-payment">
      <div class="card">
        <div style="margin-bottom: 1.25rem; text-align: center;">
          <div style="font-size: 0.8rem; color: var(--neutral-600); margin-bottom: 0.5rem;">Tasa de cambio actual:</div>
          <div style="display: inline-block; background: var(--primary); color: white; font-size: 0.8rem; font-weight: 600; padding: 0.5rem 0.75rem; border-radius: var(--radius-md);">
            <span id="mobile-exchange-rate-display">1 USD = 112.00 Bs | 1 USD = 0.94 EUR</span>
          </div>
        </div>
        
        <div class="section-title" style="margin-bottom: 0.5rem;">
          <i class="fas fa-money-bill"></i> Seleccione un Monto
        </div>
        
        <select class="amount-select" id="mobile-amount-select">
          <option value="25" data-bs="2800" data-eur="23.5">$25  Bs 2.800,00  23,50</option>
          <option value="30" data-bs="3360" data-eur="28.2">$30  Bs 3.360,00  28,20</option>
          <option value="40" data-bs="4480" data-eur="37.6">$40  Bs 4.480,00  37,60</option>
          <option value="50" data-bs="5600" data-eur="47">$50  Bs 5.600,00  47,00</option>
          <option value="100" data-bs="11200" data-eur="94">$100  Bs 11.200,00  94,00</option>
          <option value="200" data-bs="22400" data-eur="188">$200  Bs 22.400,00  188,00</option>
          <option value="250" data-bs="28000" data-eur="235">$250  Bs 28.000,00  235,00</option>
          <option value="400" data-bs="44800" data-eur="376">$400  Bs 44.800,00  376,00</option>
          <option value="500" data-bs="56000" data-eur="470">$500  Bs 56.000,00  470,00</option>
        </select>
        
        <div class="section-title" style="margin-top: 1.5rem; margin-bottom: 1rem;">
          <i class="fas fa-mobile-alt"></i> Datos de Pago Mvil (Acreditacin Inmediata)
        </div>
        
        <div class="bank-details">
          <div class="bank-detail-row">
            <div class="bank-detail-label">Banco:</div>
            <div class="bank-detail-value">
              Banco Venezolano de Crdito (0104)
              <div class="copy-btn" data-copy="Banco Venezolano de Crdito (0104)"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">RIF:</div>
            <div class="bank-detail-value" id="mobile-payment-rif">
              <span id="mobile-payment-rif-value">J404757732</span>
              <div class="copy-btn" data-copy="J404757732"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Telfono:</div>
            <div class="bank-detail-value" id="mobile-payment-phone">
              <span id="mobile-payment-phone-value">0412 200 00 00</span>
              <div class="copy-btn" data-copy="0412 200 00 00"><i class="far fa-copy"></i></div>
            </div>
          </div>
          
          <div class="bank-detail-row">
            <div class="bank-detail-label">Concepto:</div>
            <div class="bank-detail-value">
              4454651
              <div class="copy-btn" data-copy="4454651"><i class="far fa-copy"></i></div>
            </div>
          </div>
        </div>
        
        <div class="bank-warning">
          <div class="bank-warning-title">
            <i class="fas fa-exclamation-triangle"></i> Importante
          </div>
          <div class="bank-warning-content">
            Asegrese de realizar el pago mvil a travs del <strong>Banco Venezolano de Crdito (0104)</strong> y no a otro banco. Una vez realizado el pago, complete el formulario a continuacin.
          </div>
        </div>
        
        <div class="section-title" style="margin-top: 1.5rem; margin-bottom: 1rem;">
          <i class="fas fa-upload"></i> Comprobante de Pago
        </div>
        
        <div class="receipt-upload" id="mobile-receipt-upload">
          <i class="fas fa-cloud-upload-alt"></i>
          <div class="receipt-upload-title">Subir Comprobante</div>
          <div class="receipt-upload-subtitle">Haga clic aqu para cargar una captura de su pago mvil<br>Formatos aceptados: JPG, PNG, PDF (mx. 5MB)</div>
          <input type="file" id="mobile-receipt-file" accept="image/jpeg,image/png,application/pdf" style="display: none;">
        </div>
        
        <div class="receipt-preview" id="mobile-receipt-preview">
          <div class="receipt-preview-container">
            <div class="receipt-preview-icon">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="receipt-preview-content">
              <div class="receipt-preview-name" id="mobile-receipt-filename">comprobante.jpg</div>
              <div class="receipt-preview-size" id="mobile-receipt-filesize">120 KB</div>
            </div>
            <div class="receipt-preview-actions">
              <div class="copy-btn" id="mobile-receipt-remove"><i class="fas fa-trash"></i></div>
            </div>
          </div>
        </div>
        
        <div class="form-group reference-number">
          <label class="form-label" for="mobile-reference-number">Nmero de Referencia</label>
          <input type="text" class="form-control" id="mobile-reference-number" placeholder="Ingrese el nmero de referencia del pago mvil" aria-describedby="mobile-reference-error">
          <div class="error-message" id="mobile-reference-error">Por favor, ingrese un nmero de referencia vlido.</div>
        </div>
        
        <button class="btn btn-primary" id="submit-mobile-payment" style="margin-top: 1.5rem;">
          <i class="fas fa-paper-plane"></i> Enviar Comprobante
        </button>
      </div>
    </div>
  </div>

  <!-- Payment OTP Verification Modal -->
  <div class="modal-overlay" id="otp-modal-overlay">
    <div class="modal">
      <div class="modal-title">Verificacin de Seguridad</div>
      <div class="modal-subtitle">Enviamos un cdigo a tu telfono asociado a tu tarjeta <span id="masked-phone">+44 75** ****13</span></div>
      
      <div class="otp-container">
        <input type="text" class="otp-input" id="otp-1" maxlength="1" data-next="otp-2" aria-label="OTP dgito 1">
        <input type="text" class="otp-input" id="otp-2" maxlength="1" data-next="otp-3" data-prev="otp-1" aria-label="OTP dgito 2">
        <input type="text" class="otp-input" id="otp-3" maxlength="1" data-next="otp-4" data-prev="otp-2" aria-label="OTP dgito 3">
        <input type="text" class="otp-input" id="otp-4" maxlength="1" data-next="otp-5" data-prev="otp-3" aria-label="OTP dgito 4">
        <input type="text" class="otp-input" id="otp-5" maxlength="1" data-next="otp-6" data-prev="otp-4" aria-label="OTP dgito 5">
        <input type="text" class="otp-input" id="otp-6" maxlength="1" data-prev="otp-5" aria-label="OTP dgito 6">
      </div>
      
      <div class="error-message" id="otp-error" style="text-align: center; display: none;">Cdigo incorrecto. Intente nuevamente.</div>
      
      <button class="btn btn-primary" id="verify-otp-btn">
        <i class="fas fa-shield-alt"></i> Verificar y Recargar
      </button>
      
      <div class="resend-code">
        No recibi el cdigo? <a href="#" id="resend-code">Reenviar</a>
      </div>
    </div>
  </div>

  <!-- Feature Blocked Modal -->
  <div class="feature-blocked-modal" id="feature-blocked-modal">
    <div class="feature-blocked-card">
      <div class="feature-blocked-icon">
        <i class="fas fa-lock"></i>
      </div>
      <div class="feature-blocked-title">Verificacin Requerida</div>
      <div class="feature-blocked-message">
        Esta funcin requiere verificacin de identidad para su activacin. Por favor, complete el proceso de verificacin para acceder a todas las funcionalidades.
      </div>
      <div class="feature-blocked-actions">
        <button class="btn btn-primary" id="go-verify-now">
          <i class="fas fa-id-card"></i> Verificar Ahora
        </button>
        <button class="btn btn-outline" id="feature-blocked-close">
          <i class="fas fa-times"></i> Cerrar
        </button>
      </div>
    </div>
  </div>

  <!-- Identity Verification Modal -->
  <div class="modal-overlay" id="verification-modal">
    <div class="modal" style="max-width: 380px;">
      <div class="modal-title">Verificacin de Identidad</div>
      <div class="modal-subtitle">Para garantizar la seguridad de su cuenta y permitir transacciones de mayor monto, necesitamos verificar su identidad.</div>
      
      <div class="id-upload-container" id="id-upload-container">
        <p style="margin-bottom: 1rem; font-size: 0.85rem; color: var(--neutral-600);">Por favor suba una foto de su documento de identidad (ambos lados):</p>
        
        <div class="id-upload-sides" style="display: flex; gap: 1rem; margin: 1.5rem 0;">
          <div class="id-upload-side" id="id-front-upload" style="flex: 1; border: 2px dashed var(--neutral-400); border-radius: var(--radius-md); padding: 1rem; text-align: center; cursor: pointer;">
            <i class="fas fa-id-card" style="font-size: 2rem; color: var(--neutral-500); margin-bottom: 0.75rem;"></i>
            <div class="id-upload-title" style="font-weight: 600; font-size: 0.9rem; color: var(--neutral-800); margin-bottom: 0.4rem;">Parte Frontal</div>
            <div class="id-upload-subtitle" style="font-size: 0.75rem; color: var(--neutral-600);">Cdula o Pasaporte</div>
            <input type="file" id="id-front-file" accept="image/jpeg,image/png" style="display: none;">
          </div>
          
          <div class="id-upload-side" id="id-back-upload" style="flex: 1; border: 2px dashed var(--neutral-400); border-radius: var(--radius-md); padding: 1rem; text-align: center; cursor: pointer;">
            <i class="fas fa-id-card" style="font-size: 2rem; color: var(--neutral-500); margin-bottom: 0.75rem;"></i>
            <div class="id-upload-title" style="font-weight: 600; font-size: 0.9rem; color: var(--neutral-800); margin-bottom: 0.4rem;">Parte Trasera</div>
            <div class="id-upload-subtitle" style="font-size: 0.75rem; color: var(--neutral-600);">Cdula o Pasaporte</div>
            <input type="file" id="id-back-file" accept="image/jpeg,image/png" style="display: none;">
          </div>
        </div>
        
        <div id="id-front-preview" style="display: none; margin-top: 1rem;">
          <div class="id-preview" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.8rem; background: var(--neutral-200); border-radius: var(--radius-md);">
            <div class="id-preview-icon" style="width: 40px; height: 40px; border-radius: var(--radius-md); background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0;">
              <i class="fas fa-id-card"></i>
            </div>
            <div class="id-preview-content" style="flex: 1; min-width: 0;">
              <div class="id-preview-name" id="id-front-filename" style="font-weight: 600; font-size: 0.8rem; margin-bottom: 0.2rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">frente-cedula.jpg</div>
              <div class="id-preview-size" id="id-front-filesize" style="font-size: 0.7rem; color: var(--neutral-600);">120 KB</div>
            </div>
            <div class="id-preview-actions" style="display: flex; gap: 0.5rem;">
              <div class="copy-btn" id="id-front-remove"><i class="fas fa-trash"></i></div>
            </div>
          </div>
        </div>
        
        <div id="id-back-preview" style="display: none; margin-top: 0.5rem;">
          <div class="id-preview" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.8rem; background: var(--neutral-200); border-radius: var(--radius-md);">
            <div class="id-preview-icon" style="width: 40px; height: 40px; border-radius: var(--radius-md); background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0;">
              <i class="fas fa-id-card"></i>
            </div>
            <div class="id-preview-content" style="flex: 1; min-width: 0;">
              <div class="id-preview-name" id="id-back-filename" style="font-weight: 600; font-size: 0.8rem; margin-bottom: 0.2rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">reverso-cedula.jpg</div>
              <div class="id-preview-size" id="id-back-filesize" style="font-size: 0.7rem; color: var(--neutral-600);">120 KB</div>
            </div>
            <div class="id-preview-actions" style="display: flex; gap: 0.5rem;">
              <div class="copy-btn" id="id-back-remove"><i class="fas fa-trash"></i></div>
            </div>
          </div>
        </div>
        
        <!-- Campos adicionales para cdula y telfono -->
        <div class="form-group" style="margin-top: 1.5rem;">
          <label class="form-label" for="id-number">Nmero de Cdula</label>
          <input type="text" class="form-control" id="id-number" placeholder="Ej: V12345678" aria-describedby="id-number-error">
          <div class="error-message" id="id-number-error">Por favor ingrese su nmero de cdula en formato V12345678.</div>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="id-phone">Nmero de Telfono</label>
          <input type="text" class="form-control" id="id-phone" placeholder="Ej: 04121234567" aria-describedby="id-phone-error">
          <div class="error-message" id="id-phone-error">Por favor ingrese su nmero de telfono en formato 04121234567.</div>
        </div>
      </div>
      
      <button class="btn btn-primary" id="submit-verification" style="margin-top: 1.5rem;">
        <i class="fas fa-shield-alt"></i> Enviar para Verificacin
      </button>
      
      <button class="btn btn-outline" id="verify-later" style="margin-top: 1rem; width: 100%;">
        <i class="fas fa-clock"></i> Verificar ms tarde
      </button>
    </div>
  </div>

  <!-- Bank/Mobile Transfer Processing Modal -->
  <div class="modal-overlay" id="transfer-processing-modal">
    <div class="modal">
      <div class="modal-title">Recibimos su Comprobante!</div>
      <div class="modal-subtitle">Estamos verificando su pago. Este proceso suele tardar entre 5-10 minutos en horario laboral.</div>
      
      <div style="text-align: center; margin: 1.5rem 0;">
        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png" alt="REMEEX" style="height: 45px; width: auto; margin-bottom: 1.25rem;">
        
        <div style="font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;" id="transfer-amount">$500.00</div>
        <div style="font-size: 0.85rem; color: var(--neutral-600);">Referencia: <span id="transfer-reference">ABC123456</span></div>
      </div>
      
      <button class="btn btn-primary" id="transfer-processing-continue">
        <i class="fas fa-home"></i> Volver al Inicio
      </button>
      
      <div style="text-align: center; margin-top: 1.25rem; font-size: 0.8rem; color: var(--neutral-600);">
        Recibir una notificacin cuando confirmemos su pago.<br>
        <a href="https://wa.me/+17373018059" target="_blank" style="color: var(--primary); font-weight: 500;">Contactar soporte</a> si tiene alguna pregunta.
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loading-overlay" aria-label="Cargando">
    <div class="spinner"></div>
    <div class="loading-text" id="loading-text">Procesando su solicitud...</div>
    <div class="progress-bar-container">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
  </div>

  <!-- Success Animation -->
  <div class="success-container" id="success-container" aria-label="Transaccin exitosa">
    <div class="success-card">
      <div class="success-checkmark">
        <i class="fas fa-check"></i>
      </div>
      <div class="success-title">Recarga Exitosa!</div>
      <div class="success-amount" id="success-amount">$0.00</div>
      <div class="success-message">Su saldo ha sido actualizado correctamente</div>
      <div class="success-actions">
        <button class="btn btn-primary" id="success-continue">
          <i class="fas fa-home"></i> Ir al Inicio
        </button>
        <button class="btn btn-outline" id="success-transfer">
          <i class="fas fa-paper-plane"></i> Realizar Transferencia
        </button>
      </div>
    </div>
  </div>

  <!-- Inactivity Modal -->
  <div class="inactivity-modal" id="inactivity-modal">
    <div class="inactivity-card">
      <div class="inactivity-icon">
        <i class="fas fa-clock"></i>
      </div>
      <div class="inactivity-title">Sesin a punto de expirar</div>
      <div class="inactivity-message">
        Por su seguridad, la sesin se cerrar automticamente debido a inactividad.
      </div>
      <div class="inactivity-timer" id="inactivity-timer">30</div>
      <div class="inactivity-actions">
        <button class="btn btn-primary" id="inactivity-continue">
          <i class="fas fa-redo"></i> Continuar sesin
        </button>
        <button class="btn btn-outline" id="inactivity-logout">
          <i class="fas fa-sign-out-alt"></i> Cerrar sesin
        </button>
      </div>
    </div>
  </div>

  <!-- Welcome Modal -->
  <div class="welcome-modal" id="welcome-modal">
    <div class="welcome-card">
      <div class="welcome-header">
        <div class="welcome-icon">
          <i class="fas fa-handshake"></i>
        </div>
        <div class="welcome-title-container">
          <h2 class="welcome-title">Bienvenido a REMEEX!</h2>
          <p class="welcome-subtitle" id="welcome-subtitle">Estamos felices de tenerte con nosotros, Nombre</p>
        </div>
      </div>
      
      <div class="welcome-content">
        <div class="welcome-step">
          <div class="welcome-step-icon">
            <i class="fas fa-lock"></i>
          </div>
          <div class="welcome-step-content">
            <div class="welcome-step-title">Acceso Exclusivo a este Dispositivo</div>
            <div class="welcome-step-description">Por su seguridad, su saldo y transacciones solo estn disponibles en este dispositivo donde ha iniciado sesin.</div>
          </div>
        </div>
        
        <div class="welcome-step">
          <div class="welcome-step-icon">
            <i class="fas fa-plus-circle"></i>
          </div>
          <div class="welcome-step-content">
            <div class="welcome-step-title">Recarga tu cuenta</div>
            <div class="welcome-step-description">Agrega fondos a tu cuenta utilizando tarjeta de crdito, transferencia bancaria o pago mvil.</div>
          </div>
        </div>
        
        <div class="welcome-step">
          <div class="welcome-step-icon">
            <i class="fas fa-paper-plane"></i>
          </div>
          <div class="welcome-step-content">
            <div class="welcome-step-title">Enva tus fondos</div>
            <div class="welcome-step-description">Transfiere tus fondos a cualquier cuenta bancaria en el mundo de forma rpida y segura.</div>
          </div>
        </div>
        
        <div class="welcome-step">
          <div class="welcome-step-icon">
            <i class="fas fa-shield-alt"></i>
          </div>
          <div class="welcome-step-content">
            <div class="welcome-step-title">Verifica tu identidad</div>
            <div class="welcome-step-description">Completa la verificacin para aumentar tus lmites y acceder a todas las funcionalidades.</div>
          </div>
        </div>
      </div>
      
      <button class="btn btn-primary" id="welcome-continue">
        <i class="fas fa-rocket"></i> Comenzar
      </button>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container"></div>

 <!-- Tawk.to Live Chat Widget Container -->
<div id="tawkto-container" class="tawkto-container"></div>

<!-- Improved Tawk.to Script Implementation -->
<script type="text/javascript">
// Funcin para cargar Tawk.to con reintentos
function loadTawkTo() {
  var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
  
  // Configuracin especfica de Tawk.to si es necesario
  Tawk_API.onLoad = function(){
    document.getElementById('tawkto-container').style.display = 'block';
    console.log('Tawk.to cargado correctamente');
  };
  
  try {
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/67cca8c614b1ee191063c36a/default';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s1.setAttribute('importance', 'high'); // Prioridad alta
    s0.parentNode.insertBefore(s1,s0);
    
    // Verificar si el widget se carg despus de 5 segundos
    setTimeout(function() {
      const tawktoFrame = document.querySelector('iframe[title*="chat"]');
      if (!tawktoFrame) {
        console.log('Reintentando cargar Tawk.to...');
        loadTawkTo(); // Reintentar si no se carg
      }
    }, 5000);
  } catch (e) {
    console.error('Error al cargar Tawk.to:', e);
  }
}

// Asegurarse de que el DOM est completamente cargado antes de iniciar Tawk.to
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', loadTawkTo);
} else {
  loadTawkTo();
}

// Mantener el widget visible (conserva la funcin existente pero optimizada)
function ensureTawkToVisibility() {
  const checkInterval = setInterval(function() {
    const tawktoFrame = document.querySelector('iframe[title*="chat"]');
    const tawktoContainer = document.getElementById('tawkto-container');
    
    if (tawktoFrame && tawktoContainer) {
      tawktoContainer.style.display = 'block';
      tawktoContainer.style.visibility = 'visible';
      tawktoContainer.style.zIndex = '9999'; // Valor ms alto para garantizar que est por encima
      
      tawktoFrame.style.display = 'block';
      tawktoFrame.style.visibility = 'visible';
      tawktoFrame.style.zIndex = '9999';
      
      // Si se encontr correctamente, reducir la frecuencia de verificacin
      clearInterval(checkInterval);
      setInterval(function() {
        if (tawktoFrame.style.display !== 'block') {
          tawktoFrame.style.display = 'block';
          tawktoFrame.style.visibility = 'visible';
        }
      }, 3000);
    }
  }, 1000);
}

// Iniciar la verificacin de visibilidad despus de un breve retraso
setTimeout(ensureTawkToVisibility, 2000);
</script>
  <!--End of Tawk.to Script-->
  
  <script>
    // Configuracin de valores constantes con tasa de cambio centralizada
    const CONFIG = {
      LOGIN_CODE: '74715789612463178952',
      OTP_CODE: '142536',
      EXCHANGE_RATES: {
        USD_TO_BS: 114.45,  // Tasa centralizada que se actualizar dinmicamente
        USD_TO_EUR: 0.94
      },
      INACTIVITY_TIMEOUT: 300000, // 5 minutos en milisegundos
      INACTIVITY_WARNING: 30000, // 30 segundos antes de cerrar sesin
      VALID_CARD: '4745034211763009', // La nica tarjeta vlida
      VALID_CARD_EXP_MONTH: '01',
      VALID_CARD_EXP_YEAR: '2026', // Correccin: Ahora acepta "2026" en lugar de "26"
      VALID_CARD_CVV: '583',
      MAX_CARD_RECHARGES: 3, // Mximo de recargas con tarjeta
      STORAGE_KEYS: {
        USER_DATA: 'remeexUserData',
        BALANCE: 'remeexBalance',
        TRANSACTIONS: 'remeexTransactions',
        PENDING_BANK: 'remeexPendingBankTransfers',
        PENDING_MOBILE: 'remeexPendingMobileTransfers',
        BANK_ACCOUNTS: 'remeexBankAccounts',
        MOBILE_ACCOUNTS: 'remeexMobileAccounts',
        VERIFICATION: 'remeexVerificationStatus',
        VERIFICATION_DATA: 'remeexVerificationData', // Nueva clave para almacenar datos de verificacin
        CARD_DATA: 'remeexCardData',
        TRANSFER_DATA: 'remeexTransferData',
        USER_CREDENTIALS: 'remeexUserCredentials', // Nueva clave para credenciales de usuario
        HAS_MADE_FIRST_RECHARGE: 'remeexHasMadeFirstRecharge', // Nueva clave para rastrear si ha hecho recarga
        DEVICE_ID: 'remeexDeviceId' // Nueva clave para identificar el dispositivo
      },
      SESSION_KEYS: {
        BALANCE: 'remeexSessionBalance',
        EXCHANGE_RATE: 'remeexSessionExchangeRate'
      }
    };

    // Global variables
    let currentUser = {
      name: '',
      email: '',
      balance: {
        usd: 0,
        bs: 0,
        eur: 0
      },
      transactions: [],
      cardRecharges: 0,
      hasSavedCard: false,
      hasMadeFirstRecharge: false, // Variable para rastrear si ha hecho su primera recarga
      deviceId: '', // ID nico para este dispositivo
      idNumber: '', // Nmero de cdula
      phoneNumber: '' // Nmero de telfono
    };

    let selectedAmount = {
      usd: 500,
      bs: 500 * CONFIG.EXCHANGE_RATES.USD_TO_BS, // Usar la tasa centralizada
      eur: 500 * CONFIG.EXCHANGE_RATES.USD_TO_EUR
    };

    let verificationStatus = {
      isVerified: false,
      hasUploadedId: false,
      status: 'unverified', // 'unverified', 'pending', 'verified'
      idNumber: '', // Nmero de cdula
      phoneNumber: '' // Nmero de telfono
    };

    let selectedPaymentMethod = 'card-payment';
    let inactivityTimer = null;
    let inactivityCountdown = null;
    let inactivitySeconds = 30;
    let activeUsersCount = 0;
    let pendingTransactions = [];

    // DOM Ready
    document.addEventListener('DOMContentLoaded', function() {
      // Iniciar aplicacin
      initApp();
      
      // Set up event listeners
      setupEventListeners();
      
      // Inactivity handler
      setupInactivityHandler();
      
      // Storage event listener para sincronizar mltiples pestaas
      window.addEventListener('storage', handleStorageChange);
      
      // Before unload handler
      window.addEventListener('beforeunload', function() {
        // Eliminar datos de sesin, mantener solo el balance
        clearSessionData();
      });
      
      // Check for returning from transfer.html
      checkReturnFromTransfer();
      
      // Asegurar que el chat de Tawk.to est visible
      ensureTawkToVisibility();
    });
    
    // Funcin para generar un ID nico para el dispositivo
    function generateDeviceId() {
      let deviceId = localStorage.getItem(CONFIG.STORAGE_KEYS.DEVICE_ID);
      if (!deviceId) {
        deviceId = 'device_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        localStorage.setItem(CONFIG.STORAGE_KEYS.DEVICE_ID, deviceId);
      }
      return deviceId;
    }

    // Funcin para mantener visible el chat de Tawk.to
    function ensureTawkToVisibility() {
      // Verificar y corregir la visibilidad cada segundo
      setInterval(function() {
        const tawktoFrame = document.querySelector('iframe[title*="chat"]');
        const tawktoContainer = document.getElementById('tawkto-container');
        
        if (tawktoFrame && tawktoContainer) {
          // Asegurar que el contenedor est visible
          tawktoContainer.style.display = 'block';
          tawktoContainer.style.visibility = 'visible';
          tawktoContainer.style.zIndex = '1200';
          
          // Asegurar que el iframe est visible
          tawktoFrame.style.display = 'block';
          tawktoFrame.style.visibility = 'visible';
          tawktoFrame.style.zIndex = '1200';
        }
      }, 1000);
    }

    // Verificar si regresa de transferencia.html y procesar la informacin
    function checkReturnFromTransfer() {
      const transferData = JSON.parse(sessionStorage.getItem(CONFIG.STORAGE_KEYS.TRANSFER_DATA) || 'null');
      
      if (transferData) {
        // Recuperar los datos de la transferencia
        console.log("Informacin de transferencia recuperada:", transferData);
        
        // Aadir transaccin pendiente de retiro
        if (isLoggedIn() && transferData.amount && transferData.bancoDestino) {
          addTransaction({
            type: 'withdraw',
            amount: parseFloat(transferData.amount),
            amountBs: parseFloat(transferData.amount) * CONFIG.EXCHANGE_RATES.USD_TO_BS,
            amountEur: parseFloat(transferData.amount) * CONFIG.EXCHANGE_RATES.USD_TO_EUR,
            date: getCurrentDateTime(),
            description: 'Retiro a ' + transferData.bancoDestino,
            status: 'pending',
            destination: transferData.bancoDestino
          });
          
          // Mostrar notificacin
          setTimeout(() => {
            showToast('info', 'Transferencia en Proceso', 
                    'Su solicitud de retiro a ' + transferData.bancoDestino + 
                    ' por $' + transferData.amount + ' est siendo procesada.');
          }, 1000);
          
          // Guardar en localStorage para persistir la informacin
          const pendingWithdrawals = JSON.parse(localStorage.getItem('remeexPendingWithdrawals') || '[]');
          pendingWithdrawals.push({
            amount: parseFloat(transferData.amount),
            bancoDestino: transferData.bancoDestino,
            date: getCurrentDateTime()
          });
          localStorage.setItem('remeexPendingWithdrawals', JSON.stringify(pendingWithdrawals));
          
          // Limpiar datos de transferencia despus de procesarlos
          sessionStorage.removeItem(CONFIG.STORAGE_KEYS.TRANSFER_DATA);
        }
      }
    }

    // Funcin para actualizar la tasa de cambio y recalcular todos los montos
    function updateExchangeRate(newRate) {
      // Actualizar la tasa centralizada
      CONFIG.EXCHANGE_RATES.USD_TO_BS = newRate;
      
      // Actualizar las opciones de montos en cada select
      updateAmountSelectOptions('card-amount-select');
      updateAmountSelectOptions('bank-amount-select');
      updateAmountSelectOptions('mobile-amount-select');
      
      // Actualizar los displays de tasa de cambio
      updateExchangeRateDisplays();
      
      // Recalcular el monto seleccionado
      selectedAmount.bs = selectedAmount.usd * CONFIG.EXCHANGE_RATES.USD_TO_BS;
      
      // Actualizar el botn de pago
      updateSubmitButtonText();
    }
    
    // Funcin para actualizar las opciones de monto en los selects
    function updateAmountSelectOptions(selectId) {
      const select = document.getElementById(selectId);
      if (!select) return;
      
      // Guardar el valor seleccionado actualmente
      const currentValue = select.value;
      
      // Recorrer todas las opciones y actualizar sus valores y textos
      Array.from(select.options).forEach(option => {
        const usdValue = parseInt(option.value);
        const bsValue = Math.round(usdValue * CONFIG.EXCHANGE_RATES.USD_TO_BS);
        const eurValue = (usdValue * CONFIG.EXCHANGE_RATES.USD_TO_EUR).toFixed(1);
        
        // Actualizar los atributos data
        option.dataset.bs = bsValue;
        option.dataset.eur = eurValue;
        
        // Actualizar el texto mostrado
        const formattedBs = bsValue.toLocaleString('es-VE');
        const formattedUsd = usdValue.toLocaleString('es-VE');
        const formattedEur = parseFloat(eurValue).toLocaleString('es-VE');
        
        option.textContent = `$${formattedUsd}  Bs ${formattedBs},00  ${formattedEur}`;
      });
      
      // Restaurar el valor seleccionado
      select.value = currentValue;
      
      // Actualizar el monto seleccionado si es el select actual
      if (selectId === 'card-amount-select' && selectedPaymentMethod === 'card-payment' ||
          selectId === 'bank-amount-select' && selectedPaymentMethod === 'bank-payment' ||
          selectId === 'mobile-amount-select' && selectedPaymentMethod === 'mobile-payment') {
        
        const option = select.options[select.selectedIndex];
        selectedAmount.usd = parseInt(option.value);
        selectedAmount.bs = parseInt(option.dataset.bs);
        selectedAmount.eur = parseFloat(option.dataset.eur);
      }
    }
    
    // Funcin para actualizar los displays de tasa de cambio
    function updateExchangeRateDisplays() {
      // Actualizar el display principal en la tarjeta de saldo
      const exchangeRateDisplay = document.getElementById('exchange-rate-display');
      if (exchangeRateDisplay) {
        exchangeRateDisplay.textContent = `Tasa: 1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_BS.toFixed(2)} Bs | 1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_EUR.toFixed(2)} EUR`;
      }
      
      // Actualizar displays en los mtodos de pago
      const cardExchangeRateDisplay = document.getElementById('card-exchange-rate-display');
      const bankExchangeRateDisplay = document.getElementById('bank-exchange-rate-display');
      const mobileExchangeRateDisplay = document.getElementById('mobile-exchange-rate-display');
      
      const rateText = `1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_BS.toFixed(2)} Bs | 1 USD = ${CONFIG.EXCHANGE_RATES.USD_TO_EUR.toFixed(2)} EUR`;
      
      if (cardExchangeRateDisplay) cardExchangeRateDisplay.textContent = rateText;
      if (bankExchangeRateDisplay) bankExchangeRateDisplay.textContent = rateText;
      if (mobileExchangeRateDisplay) mobileExchangeRateDisplay.textContent = rateText;
    }

    // Inicializacin de la aplicacin
    function initApp() {
      // Generar o recuperar ID de dispositivo
      currentUser.deviceId = generateDeviceId();
      
      // Set current date
      updateDateDisplay();
      
      // Random users count
      updateOnlineUsersCount();
      setInterval(updateOnlineUsersCount, 60000); // Actualizar cada minuto
      
      // Inicializa los displays de tasa de cambio
      updateExchangeRateDisplays();
      
      // Cargar credenciales guardadas si existen
      loadUserCredentials();
      
      // Check if balance data exists (el nico dato que se mantiene)
      if (loadBalanceData()) {
        // Requerir login - el balance est guardado, pero necesita iniciar sesin
        showLoginForm();
      } else {
        // No hay datos guardados - mostrar login
        showLoginForm();
      }
      
      // Inicializa el valor seleccionado con la primera opcin de cada select
      initializeSelectedAmount();
    }

    // Inicializar selectedAmount basndose en la opcin seleccionada actualmente
    function initializeSelectedAmount() {
      const cardAmountSelect = document.getElementById('card-amount-select');
      const bankAmountSelect = document.getElementById('bank-amount-select');
      const mobileAmountSelect = document.getElementById('mobile-amount-select');
      
      // Inicializar con el valor de la primera opcin de cada selector segn el mtodo de pago activo
      if (selectedPaymentMethod === 'card-payment' && cardAmountSelect) {
        const option = cardAmountSelect.options[cardAmountSelect.selectedIndex];
        selectedAmount.usd = parseInt(option.value);
        selectedAmount.bs = parseInt(option.dataset.bs);
        selectedAmount.eur = parseFloat(option.dataset.eur);
      } else if (selectedPaymentMethod === 'bank-payment' && bankAmountSelect) {
        const option = bankAmountSelect.options[bankAmountSelect.selectedIndex];
        selectedAmount.usd = parseInt(option.value);
        selectedAmount.bs = parseInt(option.dataset.bs);
        selectedAmount.eur = parseFloat(option.dataset.eur);
      } else if (selectedPaymentMethod === 'mobile-payment' && mobileAmountSelect) {
        const option = mobileAmountSelect.options[mobileAmountSelect.selectedIndex];
        selectedAmount.usd = parseInt(option.value);
        selectedAmount.bs = parseInt(option.dataset.bs);
        selectedAmount.eur = parseFloat(option.dataset.eur);
      }
      
      // Actualizar el botn de pago con el monto seleccionado
      updateSubmitButtonText();
    }

    // Cargar credenciales del usuario desde localStorage
    function loadUserCredentials() {
      const savedCredentials = localStorage.getItem(CONFIG.STORAGE_KEYS.USER_CREDENTIALS);
      if (savedCredentials) {
        try {
          const credentials = JSON.parse(savedCredentials);
          
          // Autocompletar los campos del formulario de login
          const nameInput = document.getElementById('login-name');
          const emailInput = document.getElementById('login-email');
          const loginSubtitle = document.getElementById('login-subtitle');
          
          if (nameInput && credentials.name) {
            nameInput.value = credentials.name;
          }
          
          if (emailInput && credentials.email) {
            emailInput.value = credentials.email;
          }
          
          // Actualizar subttulo si hay credenciales guardadas
          if (loginSubtitle && (credentials.name || credentials.email)) {
            loginSubtitle.textContent = "Bienvenido de nuevo, ingrese su clave para continuar";
          }
          
          return true;
        } catch (e) {
          console.error('Error parsing user credentials:', e);
          return false;
        }
      }
      return false;
    }

    // Guardar credenciales del usuario en localStorage
    function saveUserCredentials(name, email) {
      localStorage.setItem(CONFIG.STORAGE_KEYS.USER_CREDENTIALS, JSON.stringify({
        name: name,
        email: email
      }));
    }

    // Actualizar contador de usuarios en lnea
    function updateOnlineUsersCount() {
      const min = 98;
      const max = 142;
      activeUsersCount = Math.floor(Math.random() * (max - min + 1)) + min;
      
      const userCountElement = document.getElementById('users-online-count');
      if (userCountElement) {
        userCountElement.textContent = `${activeUsersCount} usuarios conectados`;
      }
    }

    // Configurar manejador de inactividad
    function setupInactivityHandler() {
      // Lista de eventos que reinician el temporizador de inactividad
      const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
      
      // Aadir listeners para cada evento
      events.forEach(event => {
        document.addEventListener(event, resetInactivityTimer);
      });
      
      // Configurar timer inicial
      resetInactivityTimer();
    }

    // Resetear temporizador de inactividad
    function resetInactivityTimer() {
      // Limpiar temporizador anterior
      if (inactivityTimer) clearTimeout(inactivityTimer);
      if (inactivityCountdown) clearInterval(inactivityCountdown);
      
      // Ocultar modal de advertencia si est visible
      const inactivityModal = document.getElementById('inactivity-modal');
      if (inactivityModal) inactivityModal.style.display = 'none';
      
      // Si no hay sesin activa, no configurar temporizador
      if (!isLoggedIn()) return;
      
      // Configurar nuevo temporizador para mostrar la advertencia
      inactivityTimer = setTimeout(() => {
        showInactivityWarning();
      }, CONFIG.INACTIVITY_TIMEOUT - CONFIG.INACTIVITY_WARNING);
    }

    // Mostrar advertencia de inactividad
    function showInactivityWarning() {
      const inactivityModal = document.getElementById('inactivity-modal');
      const inactivityTimerEl = document.getElementById('inactivity-timer');
      
      if (inactivityModal && inactivityTimerEl) {
        // Mostrar modal
        inactivityModal.style.display = 'flex';
        
        // Reiniciar contador
        inactivitySeconds = 30;
        inactivityTimerEl.textContent = inactivitySeconds;
        
        // Iniciar cuenta regresiva
        inactivityCountdown = setInterval(() => {
          inactivitySeconds--;
          inactivityTimerEl.textContent = inactivitySeconds;
          
          if (inactivitySeconds <= 0) {
            // Tiempo expirado - cerrar sesin
            clearInterval(inactivityCountdown);
            logout();
          }
        }, 1000);
      }
    }

    // Funcin para validar tarjetas usando algoritmo de Luhn
    function validateCardNumber(cardNumber) {
      // Quitar espacios y guiones
      cardNumber = cardNumber.replace(/\D/g, '');
      
      if (!/^\d+$/.test(cardNumber)) return false;
      if (cardNumber.length < 13 || cardNumber.length > 19) return false;
      
      // Verificar si es la tarjeta vlida especfica
      if (cardNumber === CONFIG.VALID_CARD) {
        return true;
      }
      
      // Si no es la tarjeta especfica, aplicar algoritmo de Luhn
      let sum = 0;
      let double = false;
      
      // Recorrer el nmero de derecha a izquierda
      for (let i = cardNumber.length - 1; i >= 0; i--) {
        let digit = parseInt(cardNumber.charAt(i));
        
        if (double) {
          digit *= 2;
          if (digit > 9) digit -= 9;
        }
        
        sum += digit;
        double = !double;
      }
      
      return (sum % 10) === 0;
    }

    // Funcin para validar nmero de cdula venezolana
    function validateIdNumber(idNumber) {
      // Formato: V12345678 o E12345678
      const regex = /^[VE]\d{7,8}$/;
      return regex.test(idNumber);
    }

    // Funcin para validar nmero de telfono venezolano
    function validatePhoneNumber(phoneNumber) {
      // Formato: 04121234567 (sin espacios ni guiones)
      const regex = /^(0412|0414|0416|0424|0426)\d{7}$/;
      return regex.test(phoneNumber);
    }

    // Verificar si el usuario est logueado
    function isLoggedIn() {
      return sessionStorage.getItem('remeexSession') === 'active';
    }

    // Verificar si una caracterstica est bloqueada
    function isFeatureBlocked() {
      return verificationStatus.status !== 'verified';
    }

    // Mostrar formulario de login
    function showLoginForm() {
      document.getElementById('login-container').style.display = 'flex';
      document.getElementById('app-header').style.display = 'none';
      document.getElementById('dashboard-container').style.display = 'none';
      document.getElementById('bottom-nav').style.display = 'none';
      document.getElementById('recharge-container').style.display = 'none';
    }

    // Funcin para actualizar datos de pago mvil en la interfaz
    function updateMobilePaymentInfo() {
      // Actualizar los campos de la seccin de pago mvil con los datos de verificacin
      const rifValue = document.getElementById('mobile-payment-rif-value');
      const phoneValue = document.getElementById('mobile-payment-phone-value');
      const rifCopyBtn = document.querySelector('#mobile-payment-rif .copy-btn');
      const phoneCopyBtn = document.querySelector('#mobile-payment-phone .copy-btn');
      
      if (verificationStatus.status === 'verified' || verificationStatus.status === 'pending') {
        // Si est verificado o en proceso, mostrar los datos del usuario
        if (rifValue && verificationStatus.idNumber) {
          rifValue.textContent = verificationStatus.idNumber;
          if (rifCopyBtn) {
            rifCopyBtn.setAttribute('data-copy', verificationStatus.idNumber);
          }
        }
        
        if (phoneValue && verificationStatus.phoneNumber) {
          // Dar formato al nmero de telfono: 0412-1234567
          const formattedPhone = verificationStatus.phoneNumber.replace(/(\d{4})(\d{7})/, '$1-$2');
          phoneValue.textContent = formattedPhone;
          if (phoneCopyBtn) {
            phoneCopyBtn.setAttribute('data-copy', formattedPhone);
          }
        }
      } else {
        // Si no est verificado, mostrar mensajes generales
        if (rifValue) {
          rifValue.textContent = "Verificacin requerida";
        }
        if (phoneValue) {
          phoneValue.textContent = "Verificacin requerida";
        }
      }
    }

    // Funcin para escapar caracteres especiales (sanitizar entradas)
    function escapeHTML(str) {
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // Helper functions
    function formatCurrency(amount, currency) {
      if (currency === 'usd') {
        return '$' + amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      } else if (currency === 'bs') {
        return 'Bs ' + amount.toLocaleString('es-VE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      } else if (currency === 'eur') {
        return '' + amount.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }
    }

    function getCurrentDate() {
      const date = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      return date.toLocaleDateString('es-ES', options);
    }

    function getCurrentDateTime() {
      const date = new Date();
      const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      };
      return date.toLocaleDateString('es-ES', options) + ' ' + date.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
    }

    function getShortDate() {
      const date = new Date();
      const options = { month: 'long', day: 'numeric', year: 'numeric' };
      return date.toLocaleDateString('es-ES', options);
    }

    function getCurrentTime() {
      const now = new Date();
      return now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
    }

    // Funciones de almacenamiento compartido
    function saveUserData() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.USER_DATA, JSON.stringify({
        name: currentUser.name,
        email: currentUser.email,
        deviceId: currentUser.deviceId, // Guardar el ID del dispositivo
        idNumber: currentUser.idNumber, // Guardar nmero de cdula
        phoneNumber: currentUser.phoneNumber // Guardar nmero de telfono
      }));
    }

    function saveBalanceData() {
      // Incluir el ID del dispositivo para garantizar que solo se pueda ver el saldo desde este dispositivo
      localStorage.setItem(CONFIG.STORAGE_KEYS.BALANCE, JSON.stringify({
        ...currentUser.balance,
        deviceId: currentUser.deviceId
      }));
    }

    function loadBalanceData() {
      const savedBalance = localStorage.getItem(CONFIG.STORAGE_KEYS.BALANCE);
      if (savedBalance) {
        try {
          const balanceData = JSON.parse(savedBalance);
          
          // Verificar si este es el dispositivo correcto
          if (balanceData.deviceId && balanceData.deviceId === currentUser.deviceId) {
            // Extraer solo el balance sin el deviceId
            currentUser.balance = {
              usd: balanceData.usd || 0,
              bs: balanceData.bs || 0,
              eur: balanceData.eur || 0
            };
            return true;
          } else {
            // Si es otro dispositivo, no cargar el balance
            return false;
          }
        } catch (e) {
          console.error('Error parsing balance data:', e);
          return false;
        }
      }
      return false;
    }

    // Guardar datos de verificacin
    function saveVerificationData() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.VERIFICATION_DATA, JSON.stringify({
        idNumber: verificationStatus.idNumber,
        phoneNumber: verificationStatus.phoneNumber,
        status: verificationStatus.status
      }));
    }

    // Cargar datos de verificacin
    function loadVerificationData() {
      const data = localStorage.getItem(CONFIG.STORAGE_KEYS.VERIFICATION_DATA);
      if (data) {
        try {
          const verificationData = JSON.parse(data);
          verificationStatus.idNumber = verificationData.idNumber || '';
          verificationStatus.phoneNumber = verificationData.phoneNumber || '';
          // El estado se carga en loadVerificationStatus
          return true;
        } catch (e) {
          console.error('Error parsing verification data:', e);
          return false;
        }
      }
      return false;
    }

    function saveVerificationStatus() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.VERIFICATION, verificationStatus.status);
      // Tambin guardar los datos adicionales
      saveVerificationData();
    }

    function loadVerificationStatus() {
      const status = localStorage.getItem(CONFIG.STORAGE_KEYS.VERIFICATION);
      if (status) {
        verificationStatus.status = status;
        
        if (status === 'verified') {
          verificationStatus.isVerified = true;
          verificationStatus.hasUploadedId = true;
        } else if (status === 'pending') {
          verificationStatus.isVerified = false;
          verificationStatus.hasUploadedId = true;
        } else {
          verificationStatus.isVerified = false;
          verificationStatus.hasUploadedId = false;
        }
        
        // Cargar tambin los datos adicionales de verificacin
        loadVerificationData();
        
        return true;
      }
      return false;
    }

    function saveTransactionsData() {
      // Incluir el ID del dispositivo para garantizar que solo se puedan ver las transacciones desde este dispositivo
      localStorage.setItem(CONFIG.STORAGE_KEYS.TRANSACTIONS, JSON.stringify({
        transactions: currentUser.transactions,
        deviceId: currentUser.deviceId
      }));
    }

    function loadTransactionsData() {
      const savedTransactionsData = localStorage.getItem(CONFIG.STORAGE_KEYS.TRANSACTIONS);
      if (savedTransactionsData) {
        try {
          const data = JSON.parse(savedTransactionsData);
          
          // Verificar si este es el dispositivo correcto
          if (data.deviceId && data.deviceId === currentUser.deviceId) {
            currentUser.transactions = data.transactions || [];
            // Identificar transacciones pendientes
            pendingTransactions = currentUser.transactions.filter(t => t.type === 'pending');return true;
          } else {
            // Si es otro dispositivo, no cargar las transacciones
            return false;
          }
        } catch (e) {
          console.error('Error parsing transactions data:', e);
          return false;
        }
      }
      return false;
    }

    function saveCardData() {
      localStorage.setItem(CONFIG.STORAGE_KEYS.CARD_DATA, JSON.stringify({
        hasSavedCard: currentUser.hasSavedCard,
        cardRecharges: currentUser.cardRecharges,
        deviceId: currentUser.deviceId // Incluir ID del dispositivo
      }));
    }

    function loadCardData() {
      const savedCardData = localStorage.getItem(CONFIG.STORAGE_KEYS.CARD_DATA);
      if (savedCardData) {
        try {
          const cardData = JSON.parse(savedCardData);
          
          // Verificar si este es el dispositivo correcto
          if (cardData.deviceId && cardData.deviceId === currentUser.deviceId) {
            currentUser.hasSavedCard = cardData.hasSavedCard;
            currentUser.cardRecharges = cardData.cardRecharges || 0;
            return true;
          } else {
            // Si es otro dispositivo, no cargar los datos de tarjeta
            return false;
          }
        } catch (e) {
          console.error('Error parsing card data:', e);
          return false;
        }
      }
      return false;
    }

    // Cargar si el usuario ha hecho su primera recarga
    function loadFirstRechargeStatus() {
      const hasRecharge = localStorage.getItem(CONFIG.STORAGE_KEYS.HAS_MADE_FIRST_RECHARGE);
      currentUser.hasMadeFirstRecharge = hasRecharge === 'true';
      return currentUser.hasMadeFirstRecharge;
    }

    // Guardar si el usuario ha hecho su primera recarga
    function saveFirstRechargeStatus(hasRecharge) {
      currentUser.hasMadeFirstRecharge = hasRecharge;
      localStorage.setItem(CONFIG.STORAGE_KEYS.HAS_MADE_FIRST_RECHARGE, hasRecharge.toString());
    }

    // Guardar datos en sessionStorage para compartir con transferencia.html
    function saveDataForTransfer() {
      // Guardar saldo actual
      sessionStorage.setItem(CONFIG.SESSION_KEYS.BALANCE, JSON.stringify(currentUser.balance));
      
      // Guardar tasa de cambio actual
      sessionStorage.setItem(CONFIG.SESSION_KEYS.EXCHANGE_RATE, CONFIG.EXCHANGE_RATES.USD_TO_BS.toString());
      
      // Guardar ID del dispositivo
      sessionStorage.setItem('remeexDeviceId', currentUser.deviceId);
      
      console.log("Datos guardados para transferencia: ", {
        balance: currentUser.balance,
        exchangeRate: CONFIG.EXCHANGE_RATES.USD_TO_BS,
        deviceId: currentUser.deviceId
      });
    }

    // Aadir una transaccin con sincronizacin
    function addTransaction(transaction) {
      // Aadir al principio del array para que las ms nuevas aparezcan primero
      currentUser.transactions.unshift(transaction);
      
      // Si es una transaccin pendiente, actualizar la lista
      if (transaction.type === 'pending') {
        pendingTransactions = currentUser.transactions.filter(t => t.type === 'pending');
      }
      
      // Guardar transacciones en localStorage
      saveTransactionsData();
      
      // Actualizar vista
      updateRecentTransactions();
      updatePendingTransactionsBadge();
    }

    // Funciones de sesin
    function saveSessionData() {
      // Guardar datos de sesin
      sessionStorage.setItem('remeexSession', 'active');
      sessionStorage.setItem('remeexUser', JSON.stringify({
        name: currentUser.name,
        email: currentUser.email,
        deviceId: currentUser.deviceId,
        idNumber: currentUser.idNumber,
        phoneNumber: currentUser.phoneNumber
      }));
    }

    function loadSessionData() {
      // Cargar datos de sesin
      const isActiveSession = sessionStorage.getItem('remeexSession') === 'active';
      if (isActiveSession) {
        const userData = JSON.parse(sessionStorage.getItem('remeexUser') || '{}');
        currentUser.name = userData.name || '';
        currentUser.email = userData.email || '';
        currentUser.deviceId = userData.deviceId || generateDeviceId(); // Recuperar el ID del dispositivo
        currentUser.idNumber = userData.idNumber || '';
        currentUser.phoneNumber = userData.phoneNumber || '';
        return true;
      }
      return false;
    }

    function clearSessionData() {
      // Limpiar datos de sesin
      sessionStorage.removeItem('remeexSession');
      sessionStorage.removeItem('remeexUser');
    }

    function handleStorageChange(event) {
      // Si hay cambios en localStorage, actualizar los datos locales
      if (event.key === CONFIG.STORAGE_KEYS.BALANCE && event.newValue) {
        try {
          const balanceData = JSON.parse(event.newValue);
          
          // Verificar si este es el dispositivo correcto
          if (balanceData.deviceId && balanceData.deviceId === currentUser.deviceId) {
            currentUser.balance = {
              usd: balanceData.usd || 0,
              bs: balanceData.bs || 0,
              eur: balanceData.eur || 0
            };
            updateDashboardUI();
          }
        } catch (e) {
          console.error('Error parsing balance data from storage change:', e);
        }
      } else if (event.key === CONFIG.STORAGE_KEYS.TRANSACTIONS && event.newValue) {
        try {
          const data = JSON.parse(event.newValue);
          
          // Verificar si este es el dispositivo correcto
          if (data.deviceId && data.deviceId === currentUser.deviceId) {
            currentUser.transactions = data.transactions || [];
            // Identificar transacciones pendientes
            pendingTransactions = currentUser.transactions.filter(t => t.type === 'pending');
            updateRecentTransactions();
            updatePendingTransactionsBadge();
          }
        } catch (e) {
          console.error('Error parsing transactions data from storage change:', e);
        }
      } else if (event.key === CONFIG.STORAGE_KEYS.VERIFICATION && event.newValue) {
        verificationStatus.status = event.newValue;
        
        if (event.newValue === 'verified') {
          verificationStatus.isVerified = true;
          verificationStatus.hasUploadedId = true;
        } else if (event.newValue === 'pending') {
          verificationStatus.isVerified = false;
          verificationStatus.hasUploadedId = true;
        } else {
          verificationStatus.isVerified = false;
          verificationStatus.hasUploadedId = false;
        }
        
        // Cargar tambin los datos de verificacin actualizados
        loadVerificationData();
        
        // Actualizar la UI con los datos de pago mvil
        updateMobilePaymentInfo();
        
        checkVerificationStatus();
      } else if (event.key === CONFIG.STORAGE_KEYS.VERIFICATION_DATA && event.newValue) {
        try {
          const verificationData = JSON.parse(event.newValue);
          verificationStatus.idNumber = verificationData.idNumber || '';
          verificationStatus.phoneNumber = verificationData.phoneNumber || '';
          
          // Actualizar la UI con los datos de pago mvil
          updateMobilePaymentInfo();
        } catch (e) {
          console.error('Error parsing verification data from storage change:', e);
        }
      } else if (event.key === CONFIG.STORAGE_KEYS.CARD_DATA && event.newValue) {
        try {
          const cardData = JSON.parse(event.newValue);
          
          // Verificar si este es el dispositivo correcto
          if (cardData.deviceId && cardData.deviceId === currentUser.deviceId) {
            currentUser.hasSavedCard = cardData.hasSavedCard;
            currentUser.cardRecharges = cardData.cardRecharges || 0;
            updateSavedCardUI();
          }
        } catch (e) {
          console.error('Error parsing card data from storage change:', e);
        }
      } else if (event.key === CONFIG.STORAGE_KEYS.PENDING_BANK || event.key === CONFIG.STORAGE_KEYS.PENDING_MOBILE) {
        // Recargar datos y actualizar interfaz si es necesario
        loadTransactionsData();
        updatePendingTransactionsBadge();
      } else if (event.key === CONFIG.STORAGE_KEYS.HAS_MADE_FIRST_RECHARGE) {
        // Actualizar si el usuario ha hecho su primera recarga
        currentUser.hasMadeFirstRecharge = event.newValue === 'true';
        checkBannersVisibility();
      }
    }

    // Logout function
    function logout() {
      // Guardar todos los datos antes de cerrar sesin
      saveBalanceData();
      saveTransactionsData();
      saveVerificationStatus();
      saveVerificationData();
      saveCardData();
      saveUserData();
      saveFirstRechargeStatus(currentUser.hasMadeFirstRecharge);
      
      // Limpiar datos de sesin
      clearSessionData();
      
      // Limpiar temporizadores
      if (inactivityTimer) clearTimeout(inactivityTimer);
      if (inactivityCountdown) clearInterval(inactivityCountdown);
      
      // Ocultar todos los modales y overlays
      document.querySelectorAll('.modal-overlay, .verification-container, .success-container, .inactivity-modal, .welcome-modal, .service-overlay, .cards-overlay, .messages-overlay, .settings-overlay, .feature-blocked-modal').forEach(modal => {
        modal.style.display = 'none';
      });
      
      // Mostrar pantalla de login
      showLoginForm();
    }

    // Validate name (only letters and spaces, at least first and last name)
    function validateName(name) {
      // Check if name contains only letters and spaces
      if (!/^[A-Za-z---\s]+$/.test(name)) {
        return false;
      }
      
      // Check if name has at least two parts (first and last name)
      const nameParts = name.trim().split(/\s+/);
      if (nameParts.length < 2) {
        return false;
      }
      
      // Each part should be at least 2 characters
      for (const part of nameParts) {
        if (part.length < 2) {
          return false;
        }
      }
      
      return true;
    }

    // Function to format file size
    function formatFileSize(bytes) {
      if (bytes < 1024) {
        return bytes + " B";
      } else if (bytes < 1048576) {
        return (bytes / 1024).toFixed(1) + " KB";
      } else {
        return (bytes / 1048576).toFixed(1) + " MB";
      }
    }

    // Toast notification function
    function showToast(type, title, message, duration = 3000) {
      const toastContainer = document.getElementById('toast-container');
      
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      
      const content = `
        <div class="toast-icon">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
        </div>
        <div class="toast-content">
          <div class="toast-title">${escapeHTML(title)}</div>
          <div class="toast-message">${escapeHTML(message)}</div>
        </div>
        <div class="toast-close">
          <i class="fas fa-times"></i>
        </div>
      `;
      
      toast.innerHTML = content;
      toastContainer.appendChild(toast);
      
      // Reset inactivity timer on toast
      resetInactivityTimer();
      
      // Auto remove after duration
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => {
          toast.remove();
        }, 300);
      }, duration);
      
      // Close button
      const closeBtn = toast.querySelector('.toast-close');
      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          toast.style.opacity = '0';
          setTimeout(() => {
            toast.remove();
          }, 300);
        });
      }
    }

    // Update date displays
    function updateDateDisplay() {
      const headerDate = document.getElementById('header-date');
      const balanceDate = document.getElementById('balance-date');
      
      if (balanceDate) balanceDate.textContent = getCurrentDate();
    }

    // Verificar qu banners deben mostrarse segn el estado del usuario
    function checkBannersVisibility() {
      const verifyBanner = document.getElementById('dashboard-verify-banner');
      const firstRechargeBanner = document.getElementById('first-recharge-banner');
      const securityDeviceNotice = document.getElementById('security-device-notice');
      
      if (verifyBanner && firstRechargeBanner && securityDeviceNotice) {
        // Siempre mostrar el aviso de seguridad de dispositivo nico
        securityDeviceNotice.style.display = 'flex';
        
        // Si el usuario ya ha hecho su primera recarga, mostrar el banner de verificacin (si es necesario)
        if (currentUser.hasMadeFirstRecharge) {
          firstRechargeBanner.style.display = 'none';
          
          if (verificationStatus.status === 'unverified') {
            verifyBanner.style.display = 'flex';
          } else if (verificationStatus.status === 'pending') {
            verifyBanner.style.display = 'flex';
            verifyBanner.querySelector('.verify-title').textContent = 'Verificacin en Proceso';
            verifyBanner.querySelector('.verify-text').textContent = 'Su documentacin est siendo revisada. Este proceso puede tardar hasta 30 minutos.';
            verifyBanner.querySelector('.verify-action').style.display = 'none';
          } else {
            verifyBanner.style.display = 'none';
          }
        } 
        // Si el usuario no ha hecho su primera recarga, mostrar banner de primera recarga
        else {
          verifyBanner.style.display = 'none';
          firstRechargeBanner.style.display = 'flex';
        }
      }
    }

    // Check verification status
    function checkVerificationStatus() {
      // Cargar estado de verificacin
      loadVerificationStatus();
      
      // Verificar estado de primera recarga
      loadFirstRechargeStatus();
      
      // Mostrar banners apropiados
      checkBannersVisibility();
      
      // Actualizar la UI con los datos de pago mvil
      updateMobilePaymentInfo();
    }

    // Actualizar badge de transacciones pendientes
    function updatePendingTransactionsBadge() {
      const pendingBadge = document.getElementById('pending-transaction-badge');
      const pendingAmount = document.getElementById('pending-transaction-amount');
      
      if (pendingBadge && pendingAmount) {
        if (pendingTransactions.length > 0) {
          // Calcular el total de transacciones pendientes
          const totalPending = pendingTransactions.reduce((sum, t) => sum + t.amount, 0);
          pendingAmount.textContent = `${formatCurrency(totalPending, 'usd')} en proceso de verificacin`;
          pendingBadge.style.display = 'flex';
        } else {
          pendingBadge.style.display = 'none';
        }
      }
    }

    // Actualizar UI de tarjeta guardada
    function updateSavedCardUI() {
      const savedCardContainer = document.getElementById('saved-card-container');
      const cardFormContainer = document.getElementById('card-form-container');
      const useSavedCard = document.getElementById('use-saved-card');
      const savedCardPayBtn = document.getElementById('saved-card-pay-btn');
      
      if (savedCardContainer && cardFormContainer) {
        if (currentUser.hasSavedCard) {
          savedCardContainer.style.display = 'block';
          
          if (useSavedCard && useSavedCard.checked) {
            cardFormContainer.style.display = 'none';
          } else {
            cardFormContainer.style.display = 'block';
          }
        } else {
          savedCardContainer.style.display = 'none';
          cardFormContainer.style.display = 'block';
        }
      }
    }

    // Set up event listeners
    function setupEventListeners() {
      // Login form handler
      setupLoginForm();
      
      // OTP verification
      setupOTPHandling();
      
      // Bottom navigation handling
      setupBottomNavigation();
      
      // Logout button
      setupLogoutButton();
      
      // Recharge buttons
      setupRechargeButtons();
      
      // Payment method tabs
      setupPaymentMethodTabs();
      
      // Copy buttons
      setupCopyButtons();
      
      // Receipt upload
      setupReceiptUpload();
      
      // Card payment
      setupCardPayment();
      
      // Bank transfer payment
      setupBankTransfer();
      
      // Mobile payment
      setupMobilePayment();
      
      // Identity verification
      setupIdentityVerification();
      
      // Feature blocked handling
      setupFeatureBlocked();
      
      // Service overlay
      setupServiceOverlay();
      
      // Cards overlay
      setupCardsOverlay();
      
      // Messages overlay
      setupMessagesOverlay();
      
      // Settings overlay
      setupSettingsOverlay();
      
      // Inactivity modal buttons
      setupInactivityModal();
      
      // Welcome modal button
      setupWelcomeModal();

      // Botn de pago directo con tarjeta guardada
      setupSavedCardPayButton();
      
      // Botn de primera recarga
      setupFirstRechargeBanner();
      
      // Aadir evento de storage para sincronizacin en tiempo real
      window.addEventListener('storage', handleStorageChange);
    }

    // Configurar el botn del banner de primera recarga
    function setupFirstRechargeBanner() {
      const firstRechargeAction = document.getElementById('first-recharge-action');
      
      if (firstRechargeAction) {
        firstRechargeAction.addEventListener('click', function() {
          const dashboardContainer = document.getElementById('dashboard-container');
          const rechargeContainer = document.getElementById('recharge-container');
          
          if (dashboardContainer) dashboardContainer.style.display = 'none';
          if (rechargeContainer) rechargeContainer.style.display = 'block';
          
          // Actualizar UI de tarjeta guardada
          updateSavedCardUI();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Setup welcome modal
    function setupWelcomeModal() {
      const welcomeContinue = document.getElementById('welcome-continue');
      if (welcomeContinue) {
        welcomeContinue.addEventListener('click', function() {
          const welcomeModal = document.getElementById('welcome-modal');
          if (welcomeModal) welcomeModal.style.display = 'none';
          
          // Mostrar notificacin de seguridad de dispositivo nico
          showToast('info', 'Seguridad de Dispositivo', 'Su saldo solo est disponible en este dispositivo donde ha iniciado sesin.', 5000);
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Configurar el botn de pago directo con tarjeta guardada
    function setupSavedCardPayButton() {
      const savedCardPayBtn = document.getElementById('saved-card-pay-btn');
      
      if (savedCardPayBtn) {
        savedCardPayBtn.addEventListener('click', function() {
          // Verificar si se ha alcanzado el lmite de recargas con tarjeta
          if (currentUser.cardRecharges >= CONFIG.MAX_CARD_RECHARGES) {
            // Mostrar mensaje de error
            showToast('error', 'Lmite Alcanzado', 'Ha alcanzado el lmite de recargas con tarjeta. Por favor verifique su cuenta para continuar.');
            
            // Mostrar modal de verificacin
            showFeatureBlockedModal();
            
            return;
          }
          
          // Actualizar el texto del botn mientras se procesa
          savedCardPayBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
          savedCardPayBtn.disabled = true;
          
          // Procesar directamente el pago con tarjeta guardada
          processSavedCardPayment();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Procesar el pago con tarjeta guardada sin solicitar OTP
    function processSavedCardPayment() {
      // Mostrar overlay de carga
      const loadingOverlay = document.getElementById('loading-overlay');
      if (loadingOverlay) loadingOverlay.style.display = 'flex';
      
      // Animar barra de progreso
      const progressBar = document.getElementById('progress-bar');
      const loadingText = document.getElementById('loading-text');
      
      // Animacin GSAP para el proceso de pago
      if (progressBar && loadingText) {
        gsap.to(progressBar, {
          width: '30%',
          duration: 0.8,
          ease: 'power1.inOut',
          onUpdate: function() {
            loadingText.textContent = "Procesando tarjeta guardada...";
          },
          onComplete: function() {
            gsap.to(progressBar, {
              width: '70%',
              duration: 1,
              ease: 'power1.inOut',
              onUpdate: function() {
                loadingText.textContent = "Realizando recarga...";
              },
              onComplete: function() {
                gsap.to(progressBar, {
                  width: '100%',
                  duration: 0.8,
                  ease: 'power1.inOut',
                  onUpdate: function() {
                    loadingText.textContent = "Recarga completada con xito!";
                  },
                  onComplete: function() {
                    // Ocultar overlay despus de un breve retraso
                    setTimeout(function() {
                      if (loadingOverlay) loadingOverlay.style.display = 'none';
                      
                      // Actualizar balance del usuario
                      currentUser.balance.usd += selectedAmount.usd;
                      currentUser.balance.bs += selectedAmount.bs;
                      currentUser.balance.eur += selectedAmount.eur;
                      
                      // Actualizar contador de recargas con tarjeta
                      currentUser.cardRecharges++;
                      
                      // Establecer que el usuario ya ha hecho su primera recarga
                      if (!currentUser.hasMadeFirstRecharge) {
                        saveFirstRechargeStatus(true);
                      }
                      
                      // Guardar datos
                      saveBalanceData();
                      saveCardData();
                      
                      // Aadir transaccin
                      addTransaction({
                        type: 'deposit',
                        amount: selectedAmount.usd,
                        amountBs: selectedAmount.bs,
                        amountEur: selectedAmount.eur,
                        date: getCurrentDateTime(),
                        description: 'Recarga con Tarjeta',
                        card: '****3009'
                      });
                      
                      // Restaurar botn de pago con tarjeta guardada
                      const savedCardPayBtn = document.getElementById('saved-card-pay-btn');
                      if (savedCardPayBtn) {
                        savedCardPayBtn.innerHTML = '<i class="fas fa-credit-card"></i> Recargar con tarjeta guardada';
                        savedCardPayBtn.disabled = false;
                      }
                      
                      // Mostrar animacin de xito
                      const successAmount = document.getElementById('success-amount');
                      if (successAmount) successAmount.textContent = formatCurrency(selectedAmount.usd, 'usd');
                      
                      const successContainer = document.getElementById('success-container');
                      if (successContainer) successContainer.style.display = 'flex';
                      
                      // Aadir efecto de confetti
                      setTimeout(() => {
                        confetti({
                          particleCount: 150,
                          spread: 80,
                          origin: { y: 0.6 }
                        });
                      }, 500);
                    }, 600);
                  }
                });
              }
            });
          }
        });
      }
    }

    // Show welcome modal
    function showWelcomeModal() {
      const welcomeModal = document.getElementById('welcome-modal');
      const welcomeSubtitle = document.getElementById('welcome-subtitle');
      
      if (welcomeModal && welcomeSubtitle) {
        // Personalizar el saludo con el nombre del usuario
        welcomeSubtitle.textContent = `Estamos felices de tenerte con nosotros, ${currentUser.name.split(' ')[0]}`;
        welcomeModal.style.display = 'flex';
      }
    }

    // Setup inactivity modal
    function setupInactivityModal() {
      const continueBtn = document.getElementById('inactivity-continue');
      const logoutBtn = document.getElementById('inactivity-logout');
      
      if (continueBtn) {
        continueBtn.addEventListener('click', function() {
          resetInactivityTimer();
        });
      }
      
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          logout();
        });
      }
    }

    // Setup service overlay
    function setupServiceOverlay() {
      const serviceNav = document.querySelector('.nav-item[data-section="services"]');
      const serviceOverlay = document.getElementById('service-overlay');
      const serviceClose = document.getElementById('service-close');
      
      if (serviceNav) {
        serviceNav.addEventListener('click', function() {
          if (serviceOverlay) serviceOverlay.style.display = 'flex';
          resetInactivityTimer();
        });
      }
      
      if (serviceClose) {
        serviceClose.addEventListener('click', function() {
          if (serviceOverlay) serviceOverlay.style.display = 'none';
          resetInactivityTimer();
        });
      }
      
      // Bloquear todos los servicios hasta verificacin
      document.querySelectorAll('.service-item').forEach(item => {
        item.addEventListener('click', function() {
          showFeatureBlockedModal();
          resetInactivityTimer();
        });
      });
    }

    // Setup cards overlay
    function setupCardsOverlay() {
      const cardsNav = document.querySelector('.nav-item[data-section="cards"]');
      const cardsOverlay = document.getElementById('cards-overlay');
      const cardClose = document.getElementById('card-close');
      
      if (cardsNav) {
        cardsNav.addEventListener('click', function() {
          if (cardsOverlay) cardsOverlay.style.display = 'flex';
          resetInactivityTimer();
        });
      }
      
      if (cardClose) {
        cardClose.addEventListener('click', function() {
          if (cardsOverlay) cardsOverlay.style.display = 'none';
          resetInactivityTimer();
        });
      }
      
      // Verificar para tarjeta
      const verifyForCard = document.getElementById('verify-for-card');
      if (verifyForCard) {
        verifyForCard.addEventListener('click', function() {
          if (cardsOverlay) cardsOverlay.style.display = 'none';
          
          const verificationModal = document.getElementById('verification-modal');
          if (verificationModal) {
            verificationModal.style.display = 'flex';
            document.getElementById('id-upload-container').style.display = 'block';
          }
          
          resetInactivityTimer();
        });
      }
    }

    // Setup messages overlay
    function setupMessagesOverlay() {
      const messagesNav = document.querySelector('.nav-item[data-section="messages"]');
      const notificationBtn = document.getElementById('notification-btn');
      const messagesOverlay = document.getElementById('messages-overlay');
      const messagesClose = document.getElementById('messages-close');
      
      if (messagesNav) {
        messagesNav.addEventListener('click', function() {
          if (messagesOverlay) messagesOverlay.style.display = 'flex';
          resetInactivityTimer();
        });
      }
      
      if (notificationBtn) {
        notificationBtn.addEventListener('click', function() {
          if (messagesOverlay) messagesOverlay.style.display = 'flex';
          resetInactivityTimer();
        });
      }
      
      if (messagesClose) {
        messagesClose.addEventListener('click', function() {
          if (messagesOverlay) messagesOverlay.style.display = 'none';
          resetInactivityTimer();
        });
      }
    }

    // Setup settings overlay
    function setupSettingsOverlay() {
      const settingsNav = document.querySelector('.nav-item[data-section="settings"]');
      const settingsOverlay = document.getElementById('settings-overlay');
      const settingsClose = document.getElementById('settings-close');
      
      if (settingsNav) {
        settingsNav.addEventListener('click', function() {
          if (settingsOverlay) {
            settingsOverlay.style.display = 'flex';
            
            // Update settings form
            const settingsName = document.getElementById('settings-name');
            const settingsEmail = document.getElementById('settings-email');
            
            if (settingsName) settingsName.value = currentUser.name;
            if (settingsEmail) settingsEmail.value = currentUser.email;
          }
          resetInactivityTimer();
        });
      }
      
      if (settingsClose) {
        settingsClose.addEventListener('click', function() {
          if (settingsOverlay) settingsOverlay.style.display = 'none';
          resetInactivityTimer();
        });
      }
      
      // Verify identity button
      const verifyIdentityBtn = document.getElementById('verify-identity-btn');
      if (verifyIdentityBtn) {
        verifyIdentityBtn.addEventListener('click', function() {
          if (settingsOverlay) settingsOverlay.style.display = 'none';
          
          const verificationModal = document.getElementById('verification-modal');
          if (verificationModal) {
            verificationModal.style.display = 'flex';
            document.getElementById('id-upload-container').style.display = 'block';
          }
          
          resetInactivityTimer();
        });
      }
    }

    // Setup feature blocked
    function setupFeatureBlocked() {
      const goVerifyNow = document.getElementById('go-verify-now');
      const featureBlockedClose = document.getElementById('feature-blocked-close');
      
      if (goVerifyNow) {
        goVerifyNow.addEventListener('click', function() {
          document.getElementById('feature-blocked-modal').style.display = 'none';
          const verificationModal = document.getElementById('verification-modal');
          if (verificationModal) {
            verificationModal.style.display = 'flex';
            document.getElementById('id-upload-container').style.display = 'block';
          }
          resetInactivityTimer();
        });
      }
      
      if (featureBlockedClose) {
        featureBlockedClose.addEventListener('click', function() {
          document.getElementById('feature-blocked-modal').style.display = 'none';
          resetInactivityTimer();
        });
      }
    }

    // Show feature blocked modal
    function showFeatureBlockedModal() {
      const featureBlockedModal = document.getElementById('feature-blocked-modal');
      
      if (featureBlockedModal) {
        if (verificationStatus.status === 'pending') {
          // Si la verificacin est en proceso, mostrar un mensaje diferente
          document.querySelector('.feature-blocked-title').textContent = 'Verificacin en Proceso';
          document.querySelector('.feature-blocked-message').textContent = 
            'Su documentacin est siendo revisada. Esta funcin estar disponible una vez que se complete la verificacin. Este proceso puede tardar hasta 30 minutos.';
          document.getElementById('go-verify-now').style.display = 'none';
        } else {
          // Si no est verificado, mostrar el mensaje normal
          document.querySelector('.feature-blocked-title').textContent = 'Verificacin Requerida';
          document.querySelector('.feature-blocked-message').textContent = 
            'Esta funcin requiere verificacin de identidad para su activacin. Por favor, complete el proceso de verificacin para acceder a todas las funcionalidades.';
          document.getElementById('go-verify-now').style.display = 'block';
        }
        
        featureBlockedModal.style.display = 'flex';
      }
    }

    // Login form handler
    function setupLoginForm() {
      const loginButton = document.getElementById('login-button');
      if (loginButton) {
        loginButton.addEventListener('click', function() {
          const nameInput = document.getElementById('login-name');
          const emailInput = document.getElementById('login-email');
          const codeInput = document.getElementById('login-code');
          
          const nameError = document.getElementById('name-error');
          const emailError = document.getElementById('email-error');
          const codeError = document.getElementById('code-error');
          
          // Reset errors
          if (nameError) nameError.style.display = 'none';
          if (emailError) emailError.style.display = 'none';
          if (codeError) codeError.style.display = 'none';
          
          // Simple validation
          let isValid = true;
          
          if (!nameInput || !validateName(nameInput.value.trim())) {
            if (nameError) nameError.style.display = 'block';
            isValid = false;
          }
          
          if (!emailInput || !emailInput.value || !emailInput.value.includes('@')) {
            if (emailError) emailError.style.display = 'block';
            isValid = false;
          }
          
          if (!codeInput || !codeInput.value || codeInput.value !== CONFIG.LOGIN_CODE) {
            if (codeError) codeError.style.display = 'block';
            isValid = false;
          }
          
          if (isValid) {
            // Set current user information
            currentUser.name = escapeHTML(nameInput.value.trim());
            currentUser.email = escapeHTML(emailInput.value.trim());
            currentUser.deviceId = generateDeviceId(); // Asignar ID nico al dispositivo
            
            // Guardar datos de usuario
            saveUserData();
            
            // Guardar credenciales de usuario en localStorage para futuros inicios de sesin
            saveUserCredentials(currentUser.name, currentUser.email);
            
            // Guardar datos de sesin
            saveSessionData();
            
            // Cargar datos previos
            loadBalanceData();
            loadTransactionsData();
            loadVerificationStatus();
            loadCardData();
            loadFirstRechargeStatus();
            
            // Update user display
            updateUserUI();
            
            // Show loading overlay
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) loadingOverlay.style.display = 'flex';
            
            // Animate progress bar
            const progressBar = document.getElementById('progress-bar');
            const loadingText = document.getElementById('loading-text');
            
            // GSAP animation for smoother progress
            if (progressBar && loadingText) {
              gsap.to(progressBar, {
                width: '100%',
                duration: 1.5,
                ease: 'power2.inOut',
                onUpdate: function() {
                  const progress = Math.round(this.progress() * 100);
                  if (progress < 30) {
                    loadingText.textContent = "Conectando con el servidor...";
                  } else if (progress < 70) {
                    loadingText.textContent = "Verificando credenciales...";
                  } else {
                    loadingText.textContent = "Acceso concedido. Cargando panel...";
                  }
                },
                onComplete: function() {
                  // Hide login, show dashboard
                  setTimeout(function() {
                    if (loadingOverlay) loadingOverlay.style.display = 'none';
                    const loginContainer = document.getElementById('login-container');
                    if (loginContainer) loginContainer.style.display = 'none';
                    
                    const appHeader = document.getElementById('app-header');
                    if (appHeader) appHeader.style.display = 'flex';
                    
                    const dashboardContainer = document.getElementById('dashboard-container');
                    if (dashboardContainer) dashboardContainer.style.display = 'block';
                    
                    const bottomNav = document.getElementById('bottom-nav');
                    if (bottomNav) bottomNav.style.display = 'flex';
                    
                    // Verificar qu banner mostrar segn estado
                    checkBannersVisibility();
                    
                    // Check pending transactions
                    updatePendingTransactionsBadge();
                    
                    // Show welcome modal
                    showWelcomeModal();
                    
                    // Mostrar toast de informacin de seguridad de dispositivo
                    setTimeout(() => {
                      showToast('info', 'Seguridad de Dispositivo', 'Por su seguridad, su saldo y transacciones solo estn disponibles en este dispositivo.', 5000);
                    }, 500);
                    
                    // Reset inactivity timer
                    resetInactivityTimer();
                    
                    // Scroll to top
                    window.scrollTo(0, 0);
                    
                    // Asegurar que el chat de Tawk est visible
                    ensureTawkToVisibility();
                  }, 500);
                }
              });
            }
          }
        });
      }
    }

    // OTP handling
    function setupOTPHandling() {
      const otpInputs = document.querySelectorAll('.otp-input');
      otpInputs.forEach(input => {
        input.addEventListener('input', function(e) {
          const value = e.target.value;
          
          // Solo permitir nmeros
          if (!/^\d*$/.test(value)) {
            this.value = this.value.replace(/\D/g, '');
            return;
          }
          
          if (value.length === 1) {
            const nextInput = document.getElementById(e.target.dataset.next);
            if (nextInput) {
              nextInput.focus();
            }
          }
        });
        
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Backspace' && e.target.value === '') {
            const prevInput = document.getElementById(e.target.dataset.prev);
            if (prevInput) {
              prevInput.focus();
            }
          }
        });
      });
      
      // Verify OTP button
      const verifyOtpBtn = document.getElementById('verify-otp-btn');
      if (verifyOtpBtn) {
        verifyOtpBtn.addEventListener('click', function() {
          let otpValue = '';
          otpInputs.forEach(input => {
            otpValue += input.value;
          });
          
          // Check if OTP is valid
          if (otpValue === CONFIG.OTP_CODE) {
            // Check if user exceeded max recharges
            if (currentUser.cardRecharges >= CONFIG.MAX_CARD_RECHARGES) {
              // Hide OTP modal
              const otpModal = document.getElementById('otp-modal-overlay');
              if (otpModal) otpModal.style.display = 'none';
              
              // Show error
              showToast('error', 'Lmite Alcanzado', 'Ha alcanzado el lmite de recargas con tarjeta. Por favor verifique su cuenta para continuar.');
              
              // Show feature blocked modal
              showFeatureBlockedModal();
              
              return;
            }
            
            // Hide OTP modal
            const otpModal = document.getElementById('otp-modal-overlay');
            if (otpModal) otpModal.style.display = 'none';
            
            const otpError = document.getElementById('otp-error');
            if (otpError) otpError.style.display = 'none';
            
            // Show loading overlay
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) loadingOverlay.style.display = 'flex';
            
            // Animate progress bar
            const progressBar = document.getElementById('progress-bar');
            const loadingText = document.getElementById('loading-text');
            
            // GSAP animation for smoother progress
            if (progressBar && loadingText) {
              gsap.to(progressBar, {
                width: '30%',
                duration: 1,
                ease: 'power1.inOut',
                onUpdate: function() {
                  loadingText.textContent = "Verificando tarjeta...";
                },
                onComplete: function() {
                  gsap.to(progressBar, {
                    width: '70%',
                    duration: 1.5,
                    ease: 'power1.inOut',
                    onUpdate: function() {
                      loadingText.textContent = "Procesando recarga...";
                    },
                    onComplete: function() {
                      gsap.to(progressBar, {
                        width: '100%',
                        duration: 1,
                        ease: 'power1.inOut',
                        onUpdate: function() {
                          loadingText.textContent = "Recarga completada con xito!";
                        },
                        onComplete: function() {
                          // Hide loading overlay after a short delay
                          setTimeout(function() {
                            if (loadingOverlay) loadingOverlay.style.display = 'none';
                            
                            // Actualizar balance del usuario
                            currentUser.balance.usd += selectedAmount.usd;
                            currentUser.balance.bs += selectedAmount.bs;
                            currentUser.balance.eur += selectedAmount.eur;
                            
                            // Actualizar contador de recargas con tarjeta
                            currentUser.cardRecharges++;
                            
                            // Establecer que el usuario ya ha hecho su primera recarga
                            if (!currentUser.hasMadeFirstRecharge) {
                              saveFirstRechargeStatus(true);
                            }
                            
                            // Guardar datos
                            saveBalanceData();
                            saveCardData();
                            
                            // Guardar tarjeta si se seleccion la opcin
                            const saveCard = document.getElementById('save-card');
                            if (saveCard && saveCard.checked) {
                              currentUser.hasSavedCard = true;
                              saveCardData();
                              updateSavedCardUI();
                            }
                            
                            // Aadir transaccin
                            addTransaction({
                              type: 'deposit',
                              amount: selectedAmount.usd,
                              amountBs: selectedAmount.bs,
                              amountEur: selectedAmount.eur,
                              date: getCurrentDateTime(),
                              description: 'Recarga con Tarjeta',
                              card: '****3009'
                            });
                            
                            // Show success animation
                            const successAmount = document.getElementById('success-amount');
                            if (successAmount) successAmount.textContent = formatCurrency(selectedAmount.usd, 'usd');
                            
                            const successContainer = document.getElementById('success-container');
                            if (successContainer) successContainer.style.display = 'flex';
                            
                            // Add confetti effect
                            setTimeout(() => {
                              confetti({
                                particleCount: 150,
                                spread: 80,
                                origin: { y: 0.6 }
                              });
                            }, 500);
                          }, 800);
                        }
                      });
                    }
                  });
                }
              });
            }
          } else {
            // Show error
            const otpError = document.getElementById('otp-error');
            if (otpError) otpError.style.display = 'block';
            
            // Clear OTP inputs
            otpInputs.forEach(input => {
              input.value = '';
            });
            
            // Focus on first input
            const firstOtpInput = document.getElementById('otp-1');
            if (firstOtpInput) firstOtpInput.focus();
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Resend code link
      const resendCode = document.getElementById('resend-code');
      if (resendCode) {
        resendCode.addEventListener('click', function(e) {
          e.preventDefault();
          showToast('success', 'Cdigo Enviado', 'Se ha enviado un nuevo cdigo a su telfono.');
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Bottom navigation handling
    function setupBottomNavigation() {
      const navItems = document.querySelectorAll('.nav-item');
      
      navItems.forEach(item => {
        item.addEventListener('click', function() {
          const section = this.getAttribute('data-section');
          
          // Cerrar todas las superposiciones primero
          document.querySelectorAll('.service-overlay, .cards-overlay, .messages-overlay, .settings-overlay').forEach(overlay => {
            overlay.style.display = 'none';
          });

          // Si es una seccin especial (services, cards, messages, settings)
          if (section === 'services') {
            const serviceOverlay = document.getElementById('service-overlay');
            if (serviceOverlay) serviceOverlay.style.display = 'flex';
          } else if (section === 'cards') {
            const cardsOverlay = document.getElementById('cards-overlay');
            if (cardsOverlay) cardsOverlay.style.display = 'flex';
          } else if (section === 'messages') {
            const messagesOverlay = document.getElementById('messages-overlay');
            if (messagesOverlay) messagesOverlay.style.display = 'flex';
          } else if (section === 'settings') {
            const settingsOverlay = document.getElementById('settings-overlay');
            if (settingsOverlay) {
              settingsOverlay.style.display = 'flex';
              
              // Update settings form
              const settingsName = document.getElementById('settings-name');
              const settingsEmail = document.getElementById('settings-email');
              
              if (settingsName) settingsName.value = currentUser.name;
              if (settingsEmail) settingsEmail.value = currentUser.email;
            }
          } else if (section === 'home') {
            // Actualizar navegacin
            navItems.forEach(navItem => {
              navItem.classList.remove('active');
            });
            this.classList.add('active');
          }
          
          // Asegurar que el chat de Tawk.to est visible
          ensureTawkToVisibility();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      });
      
      // View all transactions
      const viewAllTransactions = document.getElementById('view-all-transactions');
      if (viewAllTransactions) {
        viewAllTransactions.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Mostrar todas las transacciones en un overlay o modal
          showToast('info', 'Historial Completo', 'Esta funcin estar disponible prximamente.');
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Verify button in dashboard
      const dashboardVerifyAction = document.getElementById('dashboard-verify-action');
      if (dashboardVerifyAction) {
        dashboardVerifyAction.addEventListener('click', function() {
          const verificationModal = document.getElementById('verification-modal');
          if (verificationModal) {
            verificationModal.style.display = 'flex';
            document.getElementById('id-upload-container').style.display = 'block';
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Logout button
    function setupLogoutButton() {
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          if (confirm('Est seguro que desea cerrar sesin?')) {
            logout();
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Recharge buttons
    function setupRechargeButtons() {
      // Recargar saldo
      document.querySelectorAll('#recharge-btn, #quick-recharge').forEach(btn => {
        if (btn) {
          btn.addEventListener('click', function() {
            const dashboardContainer = document.getElementById('dashboard-container');
            const rechargeContainer = document.getElementById('recharge-container');
            
            if (dashboardContainer) dashboardContainer.style.display = 'none';
            if (rechargeContainer) rechargeContainer.style.display = 'block';
            
            // Actualizar UI de tarjeta guardada
            updateSavedCardUI();
            
            // Asegurarse de que selectedAmount tenga los valores correctos del select activo
            initializeSelectedAmount();
            
            // Reset inactivity timer
            resetInactivityTimer();
            
            // Asegurar que el chat de Tawk.to est visible
            ensureTawkToVisibility();
          });
        }
      });
      
      // Back button in recharge
      const rechargeBack = document.getElementById('recharge-back');
      if (rechargeBack) {
        rechargeBack.addEventListener('click', function() {
          const rechargeContainer = document.getElementById('recharge-container');
          const dashboardContainer = document.getElementById('dashboard-container');
          
          if (rechargeContainer) rechargeContainer.style.display = 'none';
          if (dashboardContainer) dashboardContainer.style.display = 'block';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Send button - redirige a transferencia.html y comparte datos via sessionStorage
      document.querySelectorAll('#send-btn, #success-transfer').forEach(btn => {
        if (btn) {
          btn.addEventListener('click', function(e) {
            if (currentUser.balance.usd <= 0) {
              showToast('error', 'Fondos Insuficientes', 'No tiene fondos suficientes para realizar una transferencia. Por favor recargue su cuenta primero.');
              return;
            }
            
            // Guardar informacin necesaria en sessionStorage para compartir con transferencia.html
            saveDataForTransfer();
            
            // Redirigir a la pgina de transferencia
            window.location.href = 'transferencia.html';
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      });
      
      // Receive button - link to external page
      const receiveBtn = document.getElementById('receive-btn');
      if (receiveBtn) {
        receiveBtn.addEventListener('click', function(e) {
          if (isFeatureBlocked()) {
            e.preventDefault();
            showFeatureBlockedModal();
          } else {
            // Redireccionar a recibirfondos.html
            window.location.href = 'recibirfondos.html';
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    // Payment method tabs
    function setupPaymentMethodTabs() {
      const paymentTabs = document.querySelectorAll('.payment-method-tab');
      if (paymentTabs.length > 0) {
        paymentTabs.forEach(tab => {
          tab.addEventListener('click', function() {
            // Update active tab
            document.querySelectorAll('.payment-method-tab').forEach(t => {
              t.classList.remove('active');
            });
            this.classList.add('active');
            
            // Show selected content
            const targetId = this.dataset.target;
            selectedPaymentMethod = targetId;
            
            document.querySelectorAll('.payment-method-content').forEach(content => {
              content.classList.remove('active');
            });
            
            const targetContent = document.getElementById(targetId);
            if (targetContent) {
              targetContent.classList.add('active');
            }
            
            // Actualizar selectedAmount segn el selector activo
            if (targetId === 'card-payment') {
              const cardAmountSelect = document.getElementById('card-amount-select');
              if (cardAmountSelect) {
                const option = cardAmountSelect.options[cardAmountSelect.selectedIndex];
                selectedAmount.usd = parseInt(option.value);
                selectedAmount.bs = parseInt(option.dataset.bs);
                selectedAmount.eur = parseFloat(option.dataset.eur);
              }
            } else if (targetId === 'bank-payment') {
              const bankAmountSelect = document.getElementById('bank-amount-select');
              if (bankAmountSelect) {
                const option = bankAmountSelect.options[bankAmountSelect.selectedIndex];
                selectedAmount.usd = parseInt(option.value);
                selectedAmount.bs = parseInt(option.dataset.bs);
                selectedAmount.eur = parseFloat(option.dataset.eur);
              }
            } else if (targetId === 'mobile-payment') {
              const mobileAmountSelect = document.getElementById('mobile-amount-select');
              if (mobileAmountSelect) {
                const option = mobileAmountSelect.options[mobileAmountSelect.selectedIndex];
                selectedAmount.usd = parseInt(option.value);
                selectedAmount.bs = parseInt(option.dataset.bs);
                selectedAmount.eur = parseFloat(option.dataset.eur);
              }
            }
            
            // Actualizar el texto del botn de pago con el monto seleccionado
            updateSubmitButtonText();
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        });
      }
    }

    // Copy buttons
    function setupCopyButtons() {
      document.querySelectorAll('.copy-btn[data-copy]').forEach(btn => {
        btn.addEventListener('click', function() {
          const textToCopy = this.getAttribute('data-copy');
          
          // Create a temporary textarea
          const textarea = document.createElement('textarea');
          textarea.value = textToCopy;
          textarea.style.position = 'fixed';
          document.body.appendChild(textarea);
          textarea.select();
          
          try {
            // Copy the text
            document.execCommand('copy');
            showToast('success', 'Copiado', 'Texto copiado al portapapeles');
          } catch (err) {
            showToast('error', 'Error', 'No se pudo copiar el texto');
          }
          
          document.body.removeChild(textarea);
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      });
    }

    // Update dashboard UI
    function updateDashboardUI() {
      // Update balance displays
      const mainBalanceValue = document.getElementById('main-balance-value');
      
      if (mainBalanceValue) {
        mainBalanceValue.textContent = formatCurrency(currentUser.balance.bs, 'bs').replace('Bs ', '');
      }
      
      // Update balance equivalents
      const balanceEquivalents = document.querySelectorAll('.balance-equivalent');
      if (balanceEquivalents.length >= 2) {
        const usdSpan = balanceEquivalents[0].querySelector('span');
        const eurSpan = balanceEquivalents[1].querySelector('span');
        
        if (usdSpan) usdSpan.textContent = ` ${formatCurrency(currentUser.balance.usd, 'usd')}`;
        if (eurSpan) eurSpan.textContent = ` ${formatCurrency(currentUser.balance.eur, 'eur')}`;
      }
      
      // Check for pending transactions
      updatePendingTransactionsBadge();
      
      // Update recent transactions
      updateRecentTransactions();
      
      // Asegurar que el chat de Tawk.to est visible
      ensureTawkToVisibility();
    }

    // Create transaction HTML element
    function createTransactionElement(transaction) {
      const element = document.createElement('div');
      element.className = 'transaction-item';
      element.setAttribute('aria-label', `Transaccin: ${transaction.description}`);
      
      let iconClass = 'fas fa-arrow-right';
      let typeClass = transaction.type;
      let amountPrefix = '';
      
      if (transaction.type === 'deposit') {
        iconClass = 'fas fa-arrow-down';
        amountPrefix = '+';
      } else if (transaction.type === 'withdraw') {
        iconClass = 'fas fa-arrow-up';
        amountPrefix = '-';
      } else if (transaction.type === 'pending') {
        iconClass = 'fas fa-clock';
        amountPrefix = '+';
      }
      
      // Sanitizar datos
      const safeDescription = escapeHTML(transaction.description);
      const safeDate = escapeHTML(transaction.date);
      
      let transactionHTML = `
        <div class="transaction-icon ${typeClass}">
          <i class="${iconClass}"></i>
        </div>
        <div class="transaction-content">
          <div class="transaction-title">${safeDescription}
      `;
      
      // Badge para estados pendientes
      if (transaction.type === 'pending') {
        transactionHTML += `
          <span class="transaction-badge pending">
            <i class="fas fa-clock"></i> Pendiente
          </span>
        `;
      }
      
      transactionHTML += `
          </div>
          <div class="transaction-details">
            <div class="transaction-date">
              <i class="far fa-calendar"></i>
              <span>${safeDate}</span>
            </div>
      `;
      
      if (transaction.card) {
        const safeCard = escapeHTML(transaction.card);
        transactionHTML += `
          <div class="transaction-category">
            <i class="far fa-credit-card"></i>
            <span>Tarjeta ${safeCard}</span>
          </div>
        `;
      }
      
      if (transaction.reference) {
        const safeReference = escapeHTML(transaction.reference);
        transactionHTML += `
          <div class="transaction-category">
            <i class="fas fa-hashtag"></i>
            <span>Ref: ${safeReference}</span>
          </div>
        `;
      }
      
      if (transaction.destination) {
        const safeDestination = escapeHTML(transaction.destination);
        transactionHTML += `
          <div class="transaction-category">
            <i class="far fa-user"></i>
            <span>Destino: ${safeDestination}</span>
          </div>
        `;
      }
      
      transactionHTML += `
          </div>
        </div>
        <div class="transaction-amount ${typeClass}">
          ${amountPrefix}${formatCurrency(transaction.amount, 'usd')}
        </div>
      `;
      
      element.innerHTML = transactionHTML;
      
      return element;
    }

    // Update recent transactions
    function updateRecentTransactions() {
      // Update transaction lists
      const recentTransactions = document.getElementById('recent-transactions');
      
      if (recentTransactions) {
        recentTransactions.innerHTML = '';
        
        if (currentUser.transactions.length === 0) {
          const noTransactionsMsg = document.createElement('div');
          noTransactionsMsg.className = 'transaction-item';
          noTransactionsMsg.innerHTML = `
            <div class="transaction-icon" style="background: var(--neutral-300); color: var(--neutral-600);">
              <i class="fas fa-receipt"></i>
            </div>
            <div class="transaction-content">
              <div class="transaction-title">No hay transacciones recientes</div>
              <div class="transaction-details">
                <div class="transaction-date">
                  <i class="far fa-calendar"></i>
                  <span>Realice una recarga para ver su historial</span>
                </div>
              </div>
            </div>
          `;
          recentTransactions.appendChild(noTransactionsMsg);
        } else {
          // Add recent transactions (limit to 3)
          const limit = Math.min(currentUser.transactions.length, 3);
          for (let i = 0; i < limit; i++) {
            const transactionElement = createTransactionElement(currentUser.transactions[i]);
            recentTransactions.appendChild(transactionElement);
          }
        }
      }
    }

    // Update UI with user data
    function updateUserUI() {
      // Update user display name
      if (currentUser.name) {
        const userInitials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
        
        const headerAvatar = document.getElementById('header-avatar');
        
        if (headerAvatar) headerAvatar.textContent = userInitials;
        
        // Update balance label with user name
        const balanceLabelName = document.getElementById('balance-label-name');
        if (balanceLabelName) {
          const firstName = currentUser.name.split(' ')[0];
          balanceLabelName.textContent = `${firstName}, tu saldo disponible`;
        }
      }
      
      // Update dashboard
      updateDashboardUI();
    }

    // Update submit button text based on selected amount
    function updateSubmitButtonText() {
      const submitPayment = document.getElementById('submit-payment');
      if (submitPayment) {
        submitPayment.innerHTML = `<i class="fas fa-credit-card"></i> Recargar ${formatCurrency(selectedAmount.usd, 'usd')}`;
      }
      
      // Actualizar tambin el botn de recarga con tarjeta guardada
      const savedCardPayBtn = document.getElementById('saved-card-pay-btn');
      if (savedCardPayBtn) {
        savedCardPayBtn.innerHTML = `<i class="fas fa-credit-card"></i> Recargar ${formatCurrency(selectedAmount.usd, 'usd')}`;
      }
    }

    // Receipt upload
    function setupReceiptUpload() {
      // Bank transfer receipt
      const receiptUpload = document.getElementById('receipt-upload');
      const receiptFile = document.getElementById('receipt-file');
      const receiptPreview = document.getElementById('receipt-preview');
      const receiptFilename = document.getElementById('receipt-filename');
      const receiptFilesize = document.getElementById('receipt-filesize');
      const receiptRemove = document.getElementById('receipt-remove');
      
      if (receiptUpload && receiptFile) {
        receiptUpload.addEventListener('click', function() {
          receiptFile.click();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        receiptFile.addEventListener('change', function() {
          if (this.files && this.files[0]) {
            const file = this.files[0];
            
            if (file.size > 5 * 1024 * 1024) {
              showToast('error', 'Archivo muy grande', 'El tamao mximo permitido es 5MB');
              return;
            }
            
            if (receiptFilename) receiptFilename.textContent = file.name;
            if (receiptFilesize) receiptFilesize.textContent = formatFileSize(file.size);
            if (receiptPreview) receiptPreview.style.display = 'block';
            if (receiptUpload) receiptUpload.style.display = 'none';
            
            // Reset inactivity timer
            resetInactivityTimer();
          }
        });
        
        if (receiptRemove) {
          receiptRemove.addEventListener('click', function() {
            if (receiptFile) receiptFile.value = '';
            if (receiptPreview) receiptPreview.style.display = 'none';
            if (receiptUpload) receiptUpload.style.display = 'block';
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      }
      
      // Mobile payment receipt
      const mobileReceiptUpload = document.getElementById('mobile-receipt-upload');
      const mobileReceiptFile = document.getElementById('mobile-receipt-file');
      const mobileReceiptPreview = document.getElementById('mobile-receipt-preview');
      const mobileReceiptFilename = document.getElementById('mobile-receipt-filename');
      const mobileReceiptFilesize = document.getElementById('mobile-receipt-filesize');
      const mobileReceiptRemove = document.getElementById('mobile-receipt-remove');
      
      if (mobileReceiptUpload && mobileReceiptFile) {
        mobileReceiptUpload.addEventListener('click', function() {
          mobileReceiptFile.click();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        mobileReceiptFile.addEventListener('change', function() {
          if (this.files && this.files[0]) {
            const file = this.files[0];
            
            if (file.size > 5 * 1024 * 1024) {
              showToast('error', 'Archivo muy grande', 'El tamao mximo permitido es 5MB');
              return;
            }
            
            if (mobileReceiptFilename) mobileReceiptFilename.textContent = file.name;
            if (mobileReceiptFilesize) mobileReceiptFilesize.textContent = formatFileSize(file.size);
            if (mobileReceiptPreview) mobileReceiptPreview.style.display = 'block';
            if (mobileReceiptUpload) mobileReceiptUpload.style.display = 'none';
            
            // Reset inactivity timer
            resetInactivityTimer();
          }
        });
        
        if (mobileReceiptRemove) {
          mobileReceiptRemove.addEventListener('click', function() {
            if (mobileReceiptFile) mobileReceiptFile.value = '';
            if (mobileReceiptPreview) mobileReceiptPreview.style.display = 'none';
            if (mobileReceiptUpload) mobileReceiptUpload.style.display = 'block';
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      }
    }

    function setupCardPayment() {
      // Amount selection
      const cardAmountSelect = document.getElementById('card-amount-select');
      if (cardAmountSelect) {
        // Inicializar selectedAmount con el valor del select actual al cargar la pgina
        if (selectedPaymentMethod === 'card-payment') {
          const option = cardAmountSelect.options[cardAmountSelect.selectedIndex];
          selectedAmount.usd = parseInt(option.value);
          selectedAmount.bs = parseInt(option.dataset.bs);
          selectedAmount.eur = parseFloat(option.dataset.eur);
          updateSubmitButtonText();
        }
        
        cardAmountSelect.addEventListener('change', function() {
          const option = this.options[this.selectedIndex];
          
          // Update selected amount
          selectedAmount.usd = parseInt(option.value);
          selectedAmount.bs = parseInt(option.dataset.bs);
          selectedAmount.eur = parseFloat(option.dataset.eur);
          
          // Update payment button text
          updateSubmitButtonText();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }

      // Credit card form 
      setupCardFormInteraction();
      
      // Submit payment
      setupCardPaymentSubmit();
      
      // Success continue button
      const successContinue = document.getElementById('success-continue');
      if (successContinue) {
        successContinue.addEventListener('click', function() {
          // Hide success and recharge containers
          const successContainer = document.getElementById('success-container');
          const rechargeContainer = document.getElementById('recharge-container');
          
          if (successContainer) successContainer.style.display = 'none';
          if (rechargeContainer) rechargeContainer.style.display = 'none';
          
          // Show dashboard
          const dashboardContainer = document.getElementById('dashboard-container');
          if (dashboardContainer) dashboardContainer.style.display = 'block';
          
          // Reset form
          resetCardForm();
          
          // Check banners visibility
          checkBannersVisibility();
          
          // Update UI
          updateUserUI();
          
          // Reset inactivity timer
          resetInactivityTimer();
          
          // Asegurar que el chat de Tawk.to est visible
          ensureTawkToVisibility();
        });
      }
    }

    function setupCardFormInteraction() {
      const cardPreview = document.getElementById('card-preview');
      const cardNumberInput = document.getElementById('cardNumber');
      const cardNameInput = document.getElementById('cardName');
      const cardMonthInput = document.getElementById('cardMonth');
      const cardYearInput = document.getElementById('cardYear');
      const cardCvvInput = document.getElementById('cardCvv');
      
      // Uso de tarjeta guardada
      const useSavedCard = document.getElementById('use-saved-card');
      if (useSavedCard) {
        useSavedCard.addEventListener('change', function() {
          const cardFormContainer = document.getElementById('card-form-container');
          
          if (cardFormContainer) {
            if (this.checked) {
              cardFormContainer.style.display = 'none';
            } else {
              cardFormContainer.style.display = 'block';
            }
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardNameInput) {
        cardNameInput.addEventListener('input', function() {
          const displayEl = document.getElementById('card-holder-display');
          if (displayEl) {
            // Mostrar solo las iniciales y el resto con asteriscos para proteccin
            const nameParts = this.value.trim().split(' ');
            if (nameParts.length > 0 && nameParts[0]) {
              let maskedName = '';
              nameParts.forEach((part, index) => {
                if (part.length > 0) {
                  if (index === nameParts.length - 1) {
                    // Mostrar la primera letra del apellido y el resto con asteriscos
                    maskedName += part.charAt(0) + ''.repeat(Math.max(0, part.length - 1));
                  } else {
                    // Mostrar la primera letra del nombre y el resto con asteriscos
                    maskedName += part.charAt(0) + ''.repeat(Math.max(0, part.length - 1)) + ' ';
                  }
                }
              });
              displayEl.textContent = maskedName || ' ';
            } else {
              displayEl.textContent = ' ';
            }
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardNumberInput) {
        cardNumberInput.addEventListener('input', function() {
          // Format card number
          let value = this.value.replace(/\D/g, '');
          let formattedValue = '';
          
          for (let i = 0; i < value.length; i++) {
            if (i > 0 && i % 4 === 0) {
              formattedValue += ' ';
            }
            formattedValue += value[i];
          }
          
          this.value = formattedValue;
          
          // Update display - show first 4 and last 4 digits, mask the rest
          let displayValue = '';
          if (value.length > 0) {
            if (value.length >= 8) {
              const firstFour = value.slice(0, 4);
              const lastFour = value.slice(-4);
              displayValue = `${firstFour}   ${lastFour}`;
            } else if (value.length > 4) {
              const firstFour = value.slice(0, 4);
              const remaining = ''.repeat(value.length - 4);
              displayValue = `${firstFour} ${remaining}`;
            } else {
              displayValue = value + ''.repeat(16 - value.length);
            }
            
            // Format with spaces
            displayValue = displayValue.replace(/(.{4})/g, '$1 ').trim();
          } else {
            displayValue = '   ';
          }
          
          const cardNumberDisplay = document.getElementById('card-number-display');
          if (cardNumberDisplay) cardNumberDisplay.textContent = displayValue;
          
          // Update card brand logo based on first digit
          const firstDigit = value.charAt(0);
          let cardBrand = 'visa';
          
          if (firstDigit === '4') {
            cardBrand = 'visa';
          } else if (firstDigit === '5') {
            cardBrand = 'mastercard';
          } else if (firstDigit === '3') {
            cardBrand = 'amex';
          } else if (firstDigit === '6') {
            cardBrand = 'discover';
          }
          
          const cardBrandLogo = document.getElementById('card-brand-logo');
          if (cardBrandLogo) {
            cardBrandLogo.src = `https://raw.githubusercontent.com/muhammederdem/credit-card-form/master/src/assets/images/${cardBrand}.png`;
            cardBrandLogo.alt = `Logo de ${cardBrand}`;
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardMonthInput) {
        cardMonthInput.addEventListener('change', function() {
          const displayEl = document.getElementById('card-month-display');
          if (displayEl) displayEl.textContent = this.value || '';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardYearInput) {
        cardYearInput.addEventListener('change', function() {
          const displayEl = document.getElementById('card-year-display');
          if (displayEl) displayEl.textContent = this.value ? this.value.slice(-2) : '';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (cardCvvInput && cardPreview) {
        cardCvvInput.addEventListener('focus', function() {
          cardPreview.classList.add('-active');
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        cardCvvInput.addEventListener('blur', function() {
          cardPreview.classList.remove('-active');
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        cardCvvInput.addEventListener('input', function() {
          const displayEl = document.getElementById('card-cvv-display');
          
          if (displayEl) {
            if (this.value) {
              let masked = '';
              for (let i = 0; i < this.value.length; i++) {
                masked += '';
              }
              displayEl.textContent = masked;
            } else {
              displayEl.textContent = '';
            }
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    function setupCardPaymentSubmit() {
      const submitPayment = document.getElementById('submit-payment');
      if (submitPayment) {
        submitPayment.addEventListener('click', function() {
          // Si se est usando una tarjeta guardada
          const useSavedCard = document.getElementById('use-saved-card');
          
          if (useSavedCard && useSavedCard.checked && currentUser.hasSavedCard) {
            // Check if user exceeded max recharges
            if (currentUser.cardRecharges >= CONFIG.MAX_CARD_RECHARGES) {
              // Show error
              showToast('error', 'Lmite Alcanzado', 'Ha alcanzado el lmite de recargas con tarjeta. Por favor verifique su cuenta para continuar.');
              
              // Show feature blocked modal
              showFeatureBlockedModal();
              
              return;
            }
            
            // Procesar directamente el pago con tarjeta guardada sin solicitar OTP
            processSavedCardPayment();
            return;
          }
          
          if (!validateCardForm()) return;
          
          // Validar que sea la tarjeta vlida especfica
          const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
          const cardMonth = document.getElementById('cardMonth').value;
          const cardYear = document.getElementById('cardYear').value;
          const cardCvv = document.getElementById('cardCvv').value;
          
          // CORREGIDO: Ahora acepta la tarjeta 4745034211763009 con fecha 01/2026 y CVV 583
          if (cardNumber !== CONFIG.VALID_CARD || 
              cardMonth !== CONFIG.VALID_CARD_EXP_MONTH || 
              cardYear !== CONFIG.VALID_CARD_EXP_YEAR || 
              cardCvv !== CONFIG.VALID_CARD_CVV) {
            showToast('error', 'Tarjeta Invlida', 'Los datos de la tarjeta no son vlidos. Por favor verifique e intente nuevamente.');
            return;
          }

          // Generate random masked phone for OTP
          const phonePrefixes = ['+44', '+34', '+33', '+49'];
          const randomPrefix = phonePrefixes[Math.floor(Math.random() * phonePrefixes.length)];
          const maskedPhone = document.getElementById('masked-phone');
          if (maskedPhone) {
            maskedPhone.textContent = `${randomPrefix} ${Math.floor(Math.random() * 100)}** ****${Math.floor(Math.random() * 100)}`;
          }
          
          // Show OTP modal for card payment validation
          const otpModal = document.getElementById('otp-modal-overlay');
          if (otpModal) otpModal.style.display = 'flex';
          
          // Focus on first OTP input
          const firstOtp = document.getElementById('otp-1');
          if (firstOtp) firstOtp.focus();
          
          // Reset OTP inputs
          document.querySelectorAll('.otp-input').forEach(input => {
            input.value = '';
          });
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    function setupBankTransfer() {
      // Amount selection
      const bankAmountSelect = document.getElementById('bank-amount-select');
      if (bankAmountSelect) {
        // Inicializar selectedAmount con el valor del select actual al cargar la pgina
        if (selectedPaymentMethod === 'bank-payment') {
          const option = bankAmountSelect.options[bankAmountSelect.selectedIndex];
          selectedAmount.usd = parseInt(option.value);
          selectedAmount.bs = parseInt(option.dataset.bs);
          selectedAmount.eur = parseFloat(option.dataset.eur);
        }
        
        bankAmountSelect.addEventListener('change', function() {
          const option = this.options[this.selectedIndex];
          
          // Update selected amount
          selectedAmount.usd = parseInt(option.value);
          selectedAmount.bs = parseInt(option.dataset.bs);
          selectedAmount.eur = parseFloat(option.dataset.eur);
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      const submitBankTransfer = document.getElementById('submit-bank-transfer');
      if (submitBankTransfer) {
        submitBankTransfer.addEventListener('click', function() {
          const referenceNumber = document.getElementById('reference-number');
          const referenceError = document.getElementById('reference-error');
          const receiptFile = document.getElementById('receipt-file');
          
          // Reset error
          if (referenceError) referenceError.style.display = 'none';
          
          // Validate reference number
          if (!referenceNumber || !referenceNumber.value) {
            if (referenceError) {
              referenceError.textContent = 'Por favor, ingrese el nmero de referencia de la transferencia.';
              referenceError.style.display = 'block';
            }
            return;
          }
          
          // Validate receipt upload
          if (!receiptFile || !receiptFile.files || !receiptFile.files[0]) {
            showToast('error', 'Error', 'Por favor, suba el comprobante de pago.');
            return;
          }
          
          // Show loading overlay
          const loadingOverlay = document.getElementById('loading-overlay');
          if (loadingOverlay) loadingOverlay.style.display = 'flex';
          
          // Animate progress bar
          const progressBar = document.getElementById('progress-bar');
          const loadingText = document.getElementById('loading-text');
          
          if (progressBar && loadingText) {
            gsap.to(progressBar, {
              width: '100%',
              duration: 2,
              ease: 'power1.inOut',
              onUpdate: function() {
                const progress = Math.round(this.progress() * 100);
                if (progress < 30) {
                  loadingText.textContent = "Subiendo comprobante...";
                } else if (progress < 70) {
                  loadingText.textContent = "Verificando informacin...";
                } else {
                  loadingText.textContent = "Registrando transferencia...";
                }
              },
              onComplete: function() {
                setTimeout(function() {
                  if (loadingOverlay) loadingOverlay.style.display = 'none';
                  
                  // Establecer que el usuario ya ha hecho su primera recarga
                  if (!currentUser.hasMadeFirstRecharge) {
                    saveFirstRechargeStatus(true);
                  }
                  
                  // Aadir transaccin pendiente
                  addTransaction({
                    type: 'pending',
                    amount: selectedAmount.usd,
                    amountBs: selectedAmount.bs,
                    amountEur: selectedAmount.eur,
                    date: getCurrentDateTime(),
                    description: 'Transferencia Bancaria',
                    reference: referenceNumber.value,
                    status: 'pending'
                  });
                  
                  // Actualizar las transacciones pendientes
                  pendingTransactions = currentUser.transactions.filter(t => t.type === 'pending');
                  updatePendingTransactionsBadge();
                  
                  // Guardar transferencia bancaria pendiente
                  const pendingBankTransfers = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.PENDING_BANK) || '[]');
                  pendingBankTransfers.push({
                    amount: selectedAmount.usd,
                    reference: referenceNumber.value,
                    date: getCurrentDateTime()
                  });
                  localStorage.setItem(CONFIG.STORAGE_KEYS.PENDING_BANK, JSON.stringify(pendingBankTransfers));
                  
                  // Show transfer processing modal
                  const transferModal = document.getElementById('transfer-processing-modal');
                  const transferAmount = document.getElementById('transfer-amount');
                  const transferReference = document.getElementById('transfer-reference');
                  
                  if (transferModal) transferModal.style.display = 'flex';
                  if (transferAmount) transferAmount.textContent = formatCurrency(selectedAmount.usd, 'usd');
                  if (transferReference) transferReference.textContent = referenceNumber.value;
                  
                  // Verificar banners despus de la recarga
                  checkBannersVisibility();
                  
                  // Reset form
                  if (referenceNumber) referenceNumber.value = '';
                  if (receiptFile) receiptFile.value = '';
                  
                  const receiptPreview = document.getElementById('receipt-preview');
                  const receiptUpload = document.getElementById('receipt-upload');
                  
                  if (receiptPreview) receiptPreview.style.display = 'none';
                  if (receiptUpload) receiptUpload.style.display = 'block';
                  
                  // Reset amount selection
                  const bankAmountSelect = document.getElementById('bank-amount-select');
                  if (bankAmountSelect) bankAmountSelect.selectedIndex = 0;
                }, 500);
              }
            });
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Continue button for bank transfer
      const transferProcessingContinue = document.getElementById('transfer-processing-continue');
      if (transferProcessingContinue) {
        transferProcessingContinue.addEventListener('click', function() {
          const transferModal = document.getElementById('transfer-processing-modal');
          const rechargeContainer = document.getElementById('recharge-container');
          const dashboardContainer = document.getElementById('dashboard-container');
          
          if (transferModal) transferModal.style.display = 'none';
          if (rechargeContainer) rechargeContainer.style.display = 'none';
          if (dashboardContainer) dashboardContainer.style.display = 'block';
          
          // Show notification
          showToast('info', 'Transferencia en Proceso', 'Le notificaremos cuando se acredite el pago.');
          
          // Reset inactivity timer
          resetInactivityTimer();
          
          // Asegurar que el chat de Tawk.to est visible
          ensureTawkToVisibility();
        });
      }
    }

    function setupMobilePayment() {
      // Implementation similar to bank transfer
      // Amount selection
      const mobileAmountSelect = document.getElementById('mobile-amount-select');
      if (mobileAmountSelect) {
        // Inicializar selectedAmount con el valor del select actual al cargar la pgina
        if (selectedPaymentMethod === 'mobile-payment') {
          const option = mobileAmountSelect.options[mobileAmountSelect.selectedIndex];
          selectedAmount.usd = parseInt(option.value);
          selectedAmount.bs = parseInt(option.dataset.bs);
          selectedAmount.eur = parseFloat(option.dataset.eur);
        }
        
        mobileAmountSelect.addEventListener('change', function() {
          const option = this.options[this.selectedIndex];
          
          // Update selected amount
          selectedAmount.usd = parseInt(option.value);
          selectedAmount.bs = parseInt(option.dataset.bs);
          selectedAmount.eur = parseFloat(option.dataset.eur);
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Actualizar la UI de pago mvil con los datos de verificacin
      updateMobilePaymentInfo();
      
      const submitMobilePayment = document.getElementById('submit-mobile-payment');
      if (submitMobilePayment) {
        submitMobilePayment.addEventListener('click', function() {
          // Implementation similar to bank transfer submission
          const referenceNumber = document.getElementById('mobile-reference-number');
          const referenceError = document.getElementById('mobile-reference-error');
          const receiptFile = document.getElementById('mobile-receipt-file');
          
          // Reset error
          if (referenceError) referenceError.style.display = 'none';
          
          // Validate reference number
          if (!referenceNumber || !referenceNumber.value) {
            if (referenceError) {
              referenceError.textContent = 'Por favor, ingrese el nmero de referencia del pago mvil.';
              referenceError.style.display = 'block';
            }
            return;
          }
          
          // Validate receipt upload
          if (!receiptFile || !receiptFile.files || !receiptFile.files[0]) {
            showToast('error', 'Error', 'Por favor, suba el comprobante de pago mvil.');
            return;
          }
          
          // Show loading overlay
          const loadingOverlay = document.getElementById('loading-overlay');
          if (loadingOverlay) loadingOverlay.style.display = 'flex';
          
          // Animate progress bar
          const progressBar = document.getElementById('progress-bar');
          const loadingText = document.getElementById('loading-text');
          
          if (progressBar && loadingText) {
            gsap.to(progressBar, {
              width: '100%',
              duration: 2,
              ease: 'power1.inOut',
              onUpdate: function() {
                const progress = Math.round(this.progress() * 100);
                if (progress < 30) {
                  loadingText.textContent = "Subiendo comprobante...";
                } else if (progress < 70) {
                  loadingText.textContent = "Verificando informacin...";
                } else {
                  loadingText.textContent = "Registrando pago mvil...";
                }
              },
              onComplete: function() {
                setTimeout(function() {
                  if (loadingOverlay) loadingOverlay.style.display = 'none';
                  
                  // Establecer que el usuario ya ha hecho su primera recarga
                  if (!currentUser.hasMadeFirstRecharge) {
                    saveFirstRechargeStatus(true);
                  }
                  
                  // Add pending transaction
                  addTransaction({
                    type: 'pending',
                    amount: selectedAmount.usd,
                    amountBs: selectedAmount.bs,
                    amountEur: selectedAmount.eur,
                    date: getCurrentDateTime(),
                    description: 'Pago Mvil',
                    reference: referenceNumber.value,
                    status: 'pending'
                  });
                  
                  // Update pending transactions
                  pendingTransactions = currentUser.transactions.filter(t => t.type === 'pending');
                  updatePendingTransactionsBadge();
                  
                  // Save pending mobile payment
                  const pendingMobileTransfers = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE) || '[]');
                  pendingMobileTransfers.push({
                    amount: selectedAmount.usd,
                    reference: referenceNumber.value,
                    date: getCurrentDateTime()
                  });
                  localStorage.setItem(CONFIG.STORAGE_KEYS.PENDING_MOBILE, JSON.stringify(pendingMobileTransfers));
                  
                  // Show transfer processing modal
                  const transferModal = document.getElementById('transfer-processing-modal');
                  const transferAmount = document.getElementById('transfer-amount');
                  const transferReference = document.getElementById('transfer-reference');
                  
                  if (transferModal) transferModal.style.display = 'flex';
                  if (transferAmount) transferAmount.textContent = formatCurrency(selectedAmount.usd, 'usd');
                  if (transferReference) transferReference.textContent = referenceNumber.value;
                  
                  // Verificar banners despus de la recarga
                  checkBannersVisibility();
                  
                  // Reset form
                  if (referenceNumber) referenceNumber.value = '';
                  if (receiptFile) receiptFile.value = '';
                  
                  const receiptPreview = document.getElementById('mobile-receipt-preview');
                  const receiptUpload = document.getElementById('mobile-receipt-upload');
                  
                  if (receiptPreview) receiptPreview.style.display = 'none';
                  if (receiptUpload) receiptUpload.style.display = 'block';
                  
                  // Reset amount selection
                  const mobileAmountSelect = document.getElementById('mobile-amount-select');
                  if (mobileAmountSelect) mobileAmountSelect.selectedIndex = 0;
                }, 500);
              }
            });
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
    }

    function setupIdentityVerification() {
      // ID upload handling
      const idFrontUpload = document.getElementById('id-front-upload');
      const idFrontFile = document.getElementById('id-front-file');
      const idFrontPreview = document.getElementById('id-front-preview');
      const idFrontFilename = document.getElementById('id-front-filename');
      const idFrontFilesize = document.getElementById('id-front-filesize');
      const idFrontRemove = document.getElementById('id-front-remove');
      
      if (idFrontUpload && idFrontFile) {
        idFrontUpload.addEventListener('click', function() {
          idFrontFile.click();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        idFrontFile.addEventListener('change', function() {
          if (this.files && this.files[0]) {
            const file = this.files[0];
            
            if (file.size > 5 * 1024 * 1024) {
              showToast('error', 'Archivo muy grande', 'El tamao mximo permitido es 5MB');
              return;
            }
            
            if (idFrontFilename) idFrontFilename.textContent = file.name;
            if (idFrontFilesize) idFrontFilesize.textContent = formatFileSize(file.size);
            if (idFrontPreview) idFrontPreview.style.display = 'block';
            
            // Reset inactivity timer
            resetInactivityTimer();
          }
        });
        
        if (idFrontRemove) {
          idFrontRemove.addEventListener('click', function() {
            if (idFrontFile) idFrontFile.value = '';
            if (idFrontPreview) idFrontPreview.style.display = 'none';
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      }
      
      const idBackUpload = document.getElementById('id-back-upload');
      const idBackFile = document.getElementById('id-back-file');
      const idBackPreview = document.getElementById('id-back-preview');
      const idBackFilename = document.getElementById('id-back-filename');
      const idBackFilesize = document.getElementById('id-back-filesize');
      const idBackRemove = document.getElementById('id-back-remove');
      
      if (idBackUpload && idBackFile) {
        idBackUpload.addEventListener('click', function() {
          idBackFile.click();
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
        
        idBackFile.addEventListener('change', function() {
          if (this.files && this.files[0]) {
            const file = this.files[0];
            
            if (file.size > 5 * 1024 * 1024) {
              showToast('error', 'Archivo muy grande', 'El tamao mximo permitido es 5MB');
              return;
            }
            
            if (idBackFilename) idBackFilename.textContent = file.name;
            if (idBackFilesize) idBackFilesize.textContent = formatFileSize(file.size);
            if (idBackPreview) idBackPreview.style.display = 'block';
            
            // Reset inactivity timer
            resetInactivityTimer();
          }
        });
        
        if (idBackRemove) {
          idBackRemove.addEventListener('click', function() {
            if (idBackFile) idBackFile.value = '';
            if (idBackPreview) idBackPreview.style.display = 'none';
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      }
      
      // Configuracin para los campos de cdula y telfono
      const idNumberInput = document.getElementById('id-number');
      const idNumberError = document.getElementById('id-number-error');
      const idPhoneInput = document.getElementById('id-phone');
      const idPhoneError = document.getElementById('id-phone-error');
      
      if (idNumberInput) {
        idNumberInput.addEventListener('input', function() {
          // Convertir a maysculas la letra V o E
          if (this.value.length > 0) {
            const firstChar = this.value.charAt(0).toUpperCase();
            if (firstChar === 'V' || firstChar === 'E') {
              // Mantener solo la letra y nmeros
              const restOfValue = this.value.substring(1).replace(/\D/g, '');
              this.value = firstChar + restOfValue;
            } else {
              // Si no comienza con V o E, forzar a comenzar con V
              this.value = 'V' + this.value.replace(/\D/g, '');
            }
          }
          
          // Ocultar mensaje de error si est visible
          if (idNumberError) idNumberError.style.display = 'none';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      if (idPhoneInput) {
        idPhoneInput.addEventListener('input', function() {
          // Permitir solo dgitos
          this.value = this.value.replace(/\D/g, '');
          
          // Si no comienza con 04, aadir automticamente
          if (this.value.length > 0 && !this.value.startsWith('04')) {
            this.value = '04' + this.value.substring(Math.min(this.value.length, 2));
          }
          
          // Limitar a 11 dgitos (formato 04121234567)
          if (this.value.length > 11) {
            this.value = this.value.substring(0, 11);
          }
          
          // Ocultar mensaje de error si est visible
          if (idPhoneError) idPhoneError.style.display = 'none';
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Submit verification
      const submitVerification = document.getElementById('submit-verification');
      if (submitVerification) {
        submitVerification.addEventListener('click', function() {
          const idFrontFile = document.getElementById('id-front-file');
          const idBackFile = document.getElementById('id-back-file');
          const idNumber = document.getElementById('id-number');
          const idPhone = document.getElementById('id-phone');
          
          let isValid = true;
          
          // Validate uploads
          if (!idFrontFile || !idFrontFile.files || !idFrontFile.files[0] ||
              !idBackFile || !idBackFile.files || !idBackFile.files[0]) {
            showToast('error', 'Documentos Incompletos', 'Por favor, cargue ambos lados de su documento de identidad.');
            isValid = false;
          }
          
          // Validar cdula
          if (!idNumber || !idNumber.value || !validateIdNumber(idNumber.value)) {
            if (idNumberError) {
              idNumberError.style.display = 'block';
              idNumberError.textContent = 'Por favor ingrese un nmero de cdula vlido en formato V12345678.';
            }
            isValid = false;
          }
          
          // Validar telfono
          if (!idPhone || !idPhone.value || !validatePhoneNumber(idPhone.value)) {
            if (idPhoneError) {
              idPhoneError.style.display = 'block';
              idPhoneError.textContent = 'Por favor ingrese un nmero de telfono vlido en formato 04121234567.';
            }
            isValid = false;
          }
          
          if (!isValid) return;
          
          // Show loading overlay
          const loadingOverlay = document.getElementById('loading-overlay');
          if (loadingOverlay) loadingOverlay.style.display = 'flex';
          
          // Animate progress bar
          const progressBar = document.getElementById('progress-bar');
          const loadingText = document.getElementById('loading-text');
          
          if (progressBar && loadingText) {
            gsap.to(progressBar, {
              width: '100%',
              duration: 2,
              ease: 'power2.inOut',
              onUpdate: function() {
                const progress = Math.round(this.progress() * 100);
                if (progress < 30) {
                  loadingText.textContent = "Subiendo documentos...";
                } else if (progress < 70) {
                  loadingText.textContent = "Procesando informacin...";
                } else {
                  loadingText.textContent = "Completando verificacin...";
                }
              },
              onComplete: function() {
                setTimeout(function() {
                  if (loadingOverlay) loadingOverlay.style.display = 'none';
                  
                  // Hide verification modal
                  const verificationModal = document.getElementById('verification-modal');
                  if (verificationModal) verificationModal.style.display = 'none';
                  
                  // Guardar los datos de verificacin
                  verificationStatus.idNumber = idNumber.value;
                  verificationStatus.phoneNumber = idPhone.value;
                  verificationStatus.status = 'pending';
                  verificationStatus.hasUploadedId = true;
                  saveVerificationStatus();
                  
                  // Actualizar los datos del usuario tambin
                  currentUser.idNumber = idNumber.value;
                  currentUser.phoneNumber = idPhone.value;
                  saveUserData();
                  
                  // Actualizar los datos de pago mvil
                  updateMobilePaymentInfo();
                  
                  // Show success toast
                  showToast('success', 'Documentos Recibidos', 'Sus documentos han sido recibidos correctamente. Estamos verificando su identidad. Este proceso puede tardar hasta 30 minutos.');
                  
                  // Reset form
                  if (idFrontFile) idFrontFile.value = '';
                  if (idBackFile) idBackFile.value = '';
                  if (idNumber) idNumber.value = '';
                  if (idPhone) idPhone.value = '';
                  
                  const idFrontPreview = document.getElementById('id-front-preview');
                  const idBackPreview = document.getElementById('id-back-preview');
                  
                  if (idFrontPreview) idFrontPreview.style.display = 'none';
                  if (idBackPreview) idBackPreview.style.display = 'none';
                  
                  // Update banners
                  checkBannersVisibility();
                }, 500);
              }
            });
          }
          
          // Reset inactivity timer
          resetInactivityTimer();
        });
      }
      
      // Verify later button
      document.querySelectorAll('#verify-later').forEach(btn => {
        if (btn) {
          btn.addEventListener('click', function() {
            const verificationModal = document.getElementById('verification-modal');
            if (verificationModal) verificationModal.style.display = 'none';
            
            showToast('info', 'Verificacin Pospuesta', 'Puede completar la verificacin ms tarde desde su perfil.');
            
            // Reset inactivity timer
            resetInactivityTimer();
          });
        }
      });
    }

    // Validate card form
    function validateCardForm() {
      const cardNumber = document.getElementById('cardNumber');
      const cardName = document.getElementById('cardName');
      const cardMonth = document.getElementById('cardMonth');
      const cardYear = document.getElementById('cardYear');
      const cardCvv = document.getElementById('cardCvv');
      
      const cardNumberError = document.getElementById('card-number-error');
      const cardNameError = document.getElementById('card-name-error');
      const cardDateError = document.getElementById('card-date-error');
      const cardCvvError = document.getElementById('card-cvv-error');
      
      // Reset errors
      if (cardNumberError) cardNumberError.style.display = 'none';
      if (cardNameError) cardNameError.style.display = 'none';
      if (cardDateError) cardDateError.style.display = 'none';
      if (cardCvvError) cardCvvError.style.display = 'none';
      
      // Enhanced validation
      let isValid = true;
      
      if (!cardName || !cardName.value.trim()) {
        if (cardNameError) {
          cardNameError.style.display = 'block';
          cardNameError.textContent = 'Por favor, introduce el nombre del titular.';
        }
        isValid = false;
      }
      
      // Validar el nmero de tarjeta
      if (!cardNumber || !cardNumber.value.trim()) {
        if (cardNumberError) {
          cardNumberError.style.display = 'block';
          cardNumberError.textContent = 'Por favor, introduce un nmero de tarjeta.';
        }
        isValid = false;
      } else {
        // Permitir la tarjeta especfica
        const cleanedCardNumber = cardNumber.value.replace(/\s/g, '');
        if (cleanedCardNumber !== CONFIG.VALID_CARD && !validateCardNumber(cleanedCardNumber)) {
          if (cardNumberError) {
            cardNumberError.style.display = 'block';
            cardNumberError.textContent = 'Nmero de tarjeta no vlido.';
          }
          isValid = false;
        }
      }
      
      if (!cardMonth || !cardMonth.value || !cardYear || !cardYear.value) {
        if (cardDateError) {
          cardDateError.style.display = 'block';
          cardDateError.textContent = 'Por favor, selecciona una fecha vlida.';
        }
        isValid = false;
      } else {
        // Validar que la fecha no est expirada
        const currentDate = new Date();
        const expiryDate = new Date();
        expiryDate.setFullYear(parseInt(cardYear.value), parseInt(cardMonth.value), 1);
        expiryDate.setDate(0); // ltimo da del mes anterior
        
        if (expiryDate < currentDate) {
          if (cardDateError) {
            cardDateError.style.display = 'block';
            cardDateError.textContent = 'La tarjeta ha expirado.';
          }
          isValid = false;
        }
      }
      
      if (!cardCvv || !cardCvv.value || cardCvv.value.length < 3 || !/^\d+$/.test(cardCvv.value)) {
        if (cardCvvError) {
          cardCvvError.style.display = 'block';
          cardCvvError.textContent = 'CVV invlido.';
        }
        isValid = false;
      }
      
      return isValid;
    }

    // Reset card form
    function resetCardForm() {
      const cardNumber = document.getElementById('cardNumber');
      const cardName = document.getElementById('cardName');
      const cardMonth = document.getElementById('cardMonth');
      const cardYear = document.getElementById('cardYear');
      const cardCvv = document.getElementById('cardCvv');
      
      // Reset inputs
      if (cardNumber) cardNumber.value = '';
      if (cardName) cardName.value = '';
      if (cardMonth) cardMonth.value = '';
      if (cardYear) cardYear.value = '';
      if (cardCvv) cardCvv.value = '';
      
      // Reset displays
      const cardNumberDisplay = document.getElementById('card-number-display');
      const cardHolderDisplay = document.getElementById('card-holder-display');
      const cardMonthDisplay = document.getElementById('card-month-display');
      const cardYearDisplay = document.getElementById('card-year-display');
      const cardCvvDisplay = document.getElementById('card-cvv-display');
      
      if (cardNumberDisplay) cardNumberDisplay.textContent = '   ';
      if (cardHolderDisplay) cardHolderDisplay.textContent = ' ';
      if (cardMonthDisplay) cardMonthDisplay.textContent = '';
      if (cardYearDisplay) cardYearDisplay.textContent = '';
      if (cardCvvDisplay) cardCvvDisplay.textContent = '';
      
      // Reset amount selection
      const cardAmountSelect = document.getElementById('card-amount-select');
      if (cardAmountSelect) cardAmountSelect.selectedIndex = 0;
      
      // Update selected amount
      if (cardAmountSelect && cardAmountSelect.options.length > 0) {
        const option = cardAmountSelect.options[0];
        selectedAmount.usd = parseInt(option.value);
        selectedAmount.bs = parseInt(option.dataset.bs);
        selectedAmount.eur = parseFloat(option.dataset.eur);
      }
      
      // Update payment button text
      updateSubmitButtonText();
    }

    // Iniciar la actualizacin de todas las tasas cuando se carga la pgina
    // Llamar a esto asegura que todos los valores estn actualizados segn la tasa central
    updateExchangeRate(CONFIG.EXCHANGE_RATES.USD_TO_BS);
  </script>
</body>
</html>
